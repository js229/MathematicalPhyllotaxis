(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[    143594,       3223]
NotebookOptionsPosition[    138295,       3130]
NotebookOutlinePosition[    138698,       3146]
CellTagsIndexPosition[    138655,       3143]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SetDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellLabel->"In[1]:=",ExpressionUUID->"494ce339-b7c8-5341-8f74-1a3cbf665b8c"],

Cell[CellGroupData[{

Cell["\<\

Files and images\
\>", "Section",
 CellChangeTimes->{{3.945748253056408*^9, 
  3.9457482754324036`*^9}},ExpressionUUID->"f449ebd4-b5df-3d46-b9f7-\
eb4de7708843"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9456298914022503`*^9, 3.945629911250229*^9}, {
   3.945630086126835*^9, 3.9456301196414585`*^9}, {3.9456305483154488`*^9, 
   3.945630736134203*^9}, {3.945630890377136*^9, 3.9456308939166374`*^9}, {
   3.9456309459854317`*^9, 3.9456309885744343`*^9}, {3.9456311939069977`*^9, 
   3.9456312183945312`*^9}, {3.9456313208234253`*^9, 3.94563133469565*^9}, {
   3.945631476998411*^9, 3.9456315162464066`*^9}, {3.9456319346438255`*^9, 
   3.94563194780097*^9}, {3.9456320124729385`*^9, 3.945632015786461*^9}, {
   3.9456321176467495`*^9, 3.9456322218519135`*^9}, {3.94563227757185*^9, 
   3.9456322777668343`*^9}, 3.9456324136783752`*^9, {3.9456324670866337`*^9, 
   3.945632512402937*^9}, {3.945632553898796*^9, 3.945632853081333*^9}, {
   3.9456328972165413`*^9, 3.9456332389807186`*^9}, {3.945633291376808*^9, 
   3.9456333481918087`*^9}, {3.945634363799654*^9, 3.945634435758751*^9}, {
   3.945634476547058*^9, 3.94563450446113*^9}, {3.945634536660755*^9, 
   3.9456346492238617`*^9}, {3.9456347273401947`*^9, 
   3.9456347954817924`*^9}, {3.9456348499774094`*^9, 
   3.9456349018288136`*^9}, {3.9456349539650936`*^9, 
   3.9456350455425377`*^9}, {3.9456350780876217`*^9, 
   3.9456350819832363`*^9}, {3.945635120286682*^9, 3.9456352005275173`*^9}, {
   3.945635259029459*^9, 3.945635349186739*^9}, {3.9456353792458*^9, 
   3.9456353801285286`*^9}, {3.9456356916271744`*^9, 3.945635741034897*^9}, {
   3.945635785404606*^9, 3.9456357866860714`*^9}, {3.9456358356810474`*^9, 
   3.9456359372637424`*^9}, {3.945635993438343*^9, 3.9456360247106743`*^9}, {
   3.9456360584294415`*^9, 3.9456360618525066`*^9}, {3.9456362124471054`*^9, 
   3.945636234914757*^9}, {3.945636353965521*^9, 3.9456363945926857`*^9}, {
   3.9456620046323643`*^9, 3.945662008642145*^9}},
 CellLabel->"In[60]:=",ExpressionUUID->"d02adc8b-76dd-3144-8744-7b1143e0f156"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{
   "mma", " ", "bitmap", " ", "image", " ", "makes", " ", "files", " ", "too",
     " ", "large", " ", "for", " ", "github"}], "..."}], "*)"}]], "Input",
 CellChangeTimes->{{3.9457492173120823`*^9, 3.945749233495388*^9}},
 CellLabel->"In[61]:=",ExpressionUUID->"d60437de-4ed1-d44f-a986-34cbce7492b4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"replaceJPG", "[", "head_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"res", "=", "head"}], ",", "img"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"img", "=", 
        RowBox[{"head", "[", "\"\<Image\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"jpgString", " ", "=", " ", 
        RowBox[{"ExportString", "[", " ", 
         RowBox[{"img", ",", "\"\<JPG\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"res", "[", "\"\<ImageString\>\"", "]"}], "=", "jpgString"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{"res", ",", 
          RowBox[{"{", "\"\<Image\>\"", "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9457491025345764`*^9, 3.9457492038275547`*^9}, {
   3.945749238782982*^9, 3.945749242618416*^9}, 3.945749374223444*^9},
 CellLabel->"In[2]:=",ExpressionUUID->"7c241ae0-fcfd-944b-ae19-58390e21928f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"head91", "=", 
     RowBox[{"Import", "[", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{
        RowBox[{"PersistentSymbol", "[", "\"\<persistentGDrive\>\"", "]"}], 
        ",", "\"\<Work\\\\Textbook\\\\Springer\\\\SpringerMathematica\\\\Data\
\\\\head91HandCurated.mx\>\""}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"head91", "=", 
     RowBox[{"replaceJPG", "[", "head91", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"FileNameJoin", "[", 
       RowBox[{
        RowBox[{
        "PersistentSymbol", "[", "\"\<persistentGitHubPath\>\"", "]"}], ",", 
        "\"\<MathematicalPhyllotaxis\\\\Mathematica\\\\Data\>\"", ",", 
        "\"\<head91.mx\>\""}], "]"}], ",", "head91"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"head667", "=", 
     RowBox[{
     "Import", "[", 
      "\"\<E:\\\\Insync \
Gdrive\\\\Work\\\\Textbook\\\\Springer\\\\SpringerMathematica\\\\head667.mx\>\
\"", "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"head667", "=", 
     RowBox[{"replaceJPG", "[", "head667", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"FileNameJoin", "[", 
       RowBox[{
        RowBox[{
        "PersistentSymbol", "[", "\"\<persistentGitHubPath\>\"", "]"}], ",", 
        "\"\<MathematicalPhyllotaxis\\\\Mathematica\\\\Data\>\"", ",", 
        "\"\<head667.mx\>\""}], "]"}], ",", "head667"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"loadHead", "[", "headID_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"file", ",", "head"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"file", " ", "=", " ", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{
           RowBox[{
           "PersistentSymbol", "[", "\"\<persistentGitHubPath\>\"", "]"}], 
           ",", "\"\<MathematicalPhyllotaxis\\\\Mathematica\\\\Data\>\"", ",",
            "\[IndentingNewLine]", 
           RowBox[{"StringJoin", "[", 
            RowBox[{"\"\<head\>\"", ",", 
             RowBox[{"ToString", "[", "headID", "]"}], ",", "\"\<.mx\>\""}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"head", "=", " ", 
         RowBox[{"Import", "[", "file", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"!", 
            RowBox[{"KeyMemberQ", "[", 
             RowBox[{"head", ",", "\"\<Image\>\""}], "]"}]}], " ", "&&", " ", 
           RowBox[{"KeyMemberQ", "[", 
            RowBox[{"head", ",", "\"\<ImageString\>\""}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"head", "[", "\"\<Image\>\"", "]"}], "=", 
            RowBox[{"ImportString", "[", 
             RowBox[{
              RowBox[{"head", "[", "\"\<ImageString\>\"", "]"}], ",", 
              "\"\<JPG\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"head", "=", 
            RowBox[{"KeyDrop", "[", 
             RowBox[{"head", ",", 
              RowBox[{"{", "\"\<ImageString\>\"", "}"}]}], "]"}]}]}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", "head"}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"saveHead", "[", "head_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"headID", ",", "headJPG"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"headID", "=", 
        RowBox[{"head", "[", "\"\<ID\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"headJPG", "=", 
        RowBox[{"replaceJPG", "[", "head", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"FileNameJoin", "[", 
          RowBox[{
           RowBox[{
           "PersistentSymbol", "[", "\"\<persistentGitHubPath\>\"", "]"}], 
           ",", "\"\<MathematicalPhyllotaxis\\\\Mathematica\\\\Data\>\"", ",", 
           RowBox[{"StringJoin", "[", 
            RowBox[{"\"\<head\>\"", ",", 
             RowBox[{"ToString", "[", "headID", "]"}], ",", "\"\<.mx\>\""}], 
            "]"}]}], "]"}], ",", "headJPG"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945749247489958*^9, 3.945749353432436*^9}, {
   3.9457493854073315`*^9, 3.9457494146220665`*^9}, 3.9457494474840965`*^9, {
   3.945749479143862*^9, 3.945749679222887*^9}, {3.945749868442564*^9, 
   3.9457498688077393`*^9}, {3.9457501658183804`*^9, 
   3.9457501833015556`*^9}, {3.9457544374066944`*^9, 3.945754438312666*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"fc060349-6b96-7242-b2b9-1c662a8b56d0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"addMesh", "[", "head_", "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lineNodes", ",", "m"}], "}"}], " ", ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"lineNodes", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "\"\<ThreadNodes\>\"", "]"}], "&"}], ",", 
          RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"may", " ", "not", " ", "be", " ", "right"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"m", "=", 
        RowBox[{"MeshRegion", "[", 
         RowBox[{
          RowBox[{"Values", "@", 
           RowBox[{"head", "[", "\"\<Seeds\>\"", "]"}]}], ",", 
          RowBox[{"Map", "[", 
           RowBox[{"Line", ",", "lineNodes"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Append", "[", 
        RowBox[{"head", ",", 
         RowBox[{"\"\<Mesh\>\"", "->", "m"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9457497809898453`*^9, 3.9457497824469357`*^9}, {
   3.9457498199780807`*^9, 3.9457498657146397`*^9}, 3.9457505222437286`*^9, {
   3.9457505741726933`*^9, 3.9457505817218056`*^9}, 3.945754301375454*^9},
 CellLabel->"In[5]:=",ExpressionUUID->"e5cdf50e-cefc-6544-b1c2-3c342ff44782"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Initial seed placements", "Section",
 CellChangeTimes->{{3.945748289470995*^9, 
  3.9457482962613277`*^9}},ExpressionUUID->"85b3468a-0dcc-b14d-a9b4-\
b6eeea655c21"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "legacy", " ", "code", " ", "would", " ", "need", " ", "to", " ", "be", " ",
    "refactored"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.9456623097495785`*^9, 3.945662367247015*^9}, {
  3.9457501177210712`*^9, 3.9457501290322933`*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"0699b8a8-3d74-4e47-a31e-7ebe485ba841"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"deleteLastPointFromThread", "[", "threadAssociation_", "]"}], " ",
    ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "currentThreadKey"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"res", "=", "threadAssociation"}], ";", "\[IndentingNewLine]", 
      RowBox[{"currentThreadKey", "=", 
       RowBox[{"Last", "@", 
        RowBox[{"Keys", "@", "threadAssociation"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"res", "[", "currentThreadKey", "]"}], "]"}], ">", "0"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "currentThreadKey", "]"}], "=", 
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"res", "[", "currentThreadKey", "]"}], ",", 
           RowBox[{"-", "1"}]}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]",
       "res"}]}], " ", "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, {3.945665114884842*^9, 3.9456651224462833`*^9}, {
   3.945665177768202*^9, 3.94566522346756*^9}, {3.945665562049608*^9, 
   3.945665566303217*^9}, {3.9456655965162983`*^9, 3.945665662125942*^9}, {
   3.9456658763551235`*^9, 3.9456659130231056`*^9}, {3.945665979404793*^9, 
   3.9456661049732227`*^9}, {3.9456661846290684`*^9, 
   3.9456661920768566`*^9}, {3.9456662443676453`*^9, 
   3.9456663315072327`*^9}, {3.945666374055807*^9, 3.9456664436976376`*^9}, {
   3.9456665038166924`*^9, 3.9456665672163258`*^9}, {3.9456666505448456`*^9, 
   3.945666830639948*^9}, {3.945667105590292*^9, 3.94566713188307*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"21f95167-d15a-9540-8048-88fb0d090783"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"capturePoint", "[", "]"}], ":=", " ", 
   RowBox[{"Round", "/@", 
    RowBox[{"MousePosition", "[", "\"\<Graphics\>\"", "]"}]}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, {3.945665114884842*^9, 3.9456651224462833`*^9}, {
   3.945665177768202*^9, 3.94566522346756*^9}, {3.945665562049608*^9, 
   3.945665566303217*^9}, {3.9456655965162983`*^9, 3.945665662125942*^9}, {
   3.9456658763551235`*^9, 3.9456659130231056`*^9}, {3.945665979404793*^9, 
   3.9456661049732227`*^9}, {3.9456661846290684`*^9, 
   3.9456661920768566`*^9}, {3.9456662443676453`*^9, 
   3.9456663315072327`*^9}, {3.945666374055807*^9, 3.9456664436976376`*^9}, {
   3.9456665038166924`*^9, 3.9456665672163258`*^9}, {3.9456666505448456`*^9, 
   3.9456668385342083`*^9}, 3.945748307419981*^9},
 CellLabel->"In[7]:=",ExpressionUUID->"69a414b4-9881-494d-af3a-6e02872e95c7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"newThread", "[", "threadAssociation_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "threadID", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"threadID", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "threadAssociation", "]"}], "==", "0"}], ",",
          "1", ",", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{"Keys", "[", "threadAssociation", "]"}], "]"}], "+", 
          "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Append", "[", 
       RowBox[{"threadAssociation", ",", 
        RowBox[{"threadID", "->", 
         RowBox[{"{", "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, {3.945665114884842*^9, 3.9456651224462833`*^9}, {
   3.945665177768202*^9, 3.94566522346756*^9}, {3.945665562049608*^9, 
   3.945665566303217*^9}, {3.9456655965162983`*^9, 3.945665662125942*^9}, {
   3.9456658763551235`*^9, 3.9456659130231056`*^9}, {3.945665979404793*^9, 
   3.9456661049732227`*^9}, {3.9456661846290684`*^9, 
   3.9456661920768566`*^9}, {3.9456662443676453`*^9, 
   3.9456663315072327`*^9}, {3.945666374055807*^9, 3.9456664436976376`*^9}, {
   3.9456665038166924`*^9, 3.9456665672163258`*^9}, {3.9456666505448456`*^9, 
   3.9456668385342083`*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"74719bce-2dc7-bc4a-87c0-413be11034dd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"scol", "[", "threadAssociation_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lastThread", ",", "lastPoint"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "threadAssociation", "]"}], "==", "0"}], ",", 
        RowBox[{"lastThread", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"lastThread", "=", 
         RowBox[{"Last", "[", "threadAssociation", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "lastThread", "]"}], "==", "0"}], ",", 
        RowBox[{"lastPoint", "=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{"lastPoint", "=", 
         RowBox[{"Last", "[", "lastThread", "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"Image", "[", 
         RowBox[{"i667", ",", 
          RowBox[{"ImageSize", "->", "Large"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Green", ",", 
                RowBox[{"Line", "[", "#", "]"}]}], "}"}], "&"}], ",", 
             RowBox[{"Values", "[", "threadAssociation", "]"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Yellow", ",", 
             RowBox[{"Point", "[", "lastThread", "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Red", ",", 
             RowBox[{"Point", "[", "lastPoint", "]"}]}], "}"}]}], 
          "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", "]"}]}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"addPointToThread", "[", 
    RowBox[{"threadAssociation_", ",", "point_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", ",", "currentThreadKey"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"res", "=", "threadAssociation"}], ";", "\[IndentingNewLine]", 
      RowBox[{"currentThreadKey", "=", 
       RowBox[{"Last", "@", 
        RowBox[{"Keys", "@", "threadAssociation"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", "[", "currentThreadKey", "]"}], "=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"res", "[", "currentThreadKey", "]"}], ",", "point"}], 
        "]"}]}], ";", "\[IndentingNewLine]", "res"}]}], " ", 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, {3.945665114884842*^9, 3.9456651224462833`*^9}, {
   3.945665177768202*^9, 3.94566522346756*^9}, {3.945665562049608*^9, 
   3.945665566303217*^9}, {3.9456655965162983`*^9, 3.945665662125942*^9}, {
   3.9456658763551235`*^9, 3.9456659130231056`*^9}, {3.945665979404793*^9, 
   3.9456661049732227`*^9}, {3.9456661846290684`*^9, 
   3.9456661920768566`*^9}, {3.9456662443676453`*^9, 
   3.9456663315072327`*^9}, {3.945666374055807*^9, 3.9456664436976376`*^9}, {
   3.9456665038166924`*^9, 3.9456665672163258`*^9}, {3.9456666505448456`*^9, 
   3.9456668191856155`*^9}, {3.9456669642440453`*^9, 3.9456670083795605`*^9}},
 CellLabel->"In[9]:=",ExpressionUUID->"b923d20e-8b8a-494e-af90-c6cb84dc18b3"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"pointCollector", "[", 
      RowBox[{"threadsKnown_", ":", 
       RowBox[{"<|", 
        RowBox[{"1", "->", 
         RowBox[{"{", "}"}]}], "|>"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"DynamicModule", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"point", "=", 
            RowBox[{"Missing", "[", "]"}]}], ",", 
           RowBox[{"threadAssociation", "=", "threadsKnown"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Row", "[", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Undo point\>\"", ",", 
                 RowBox[{"threadAssociation", "=", 
                  RowBox[{
                  "deleteLastPointFromThread", "[", "threadAssociation", 
                   "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Make thread\>\"", ",", 
                 RowBox[{"threadAssociation", "=", 
                  RowBox[{"newThread", "[", "threadAssociation", "]"}]}]}], 
                "]"}], ",", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Print thread\>\"", ",", 
                 RowBox[{"Print", "[", "threadAssociation", "]"}]}], "]"}]}], 
              "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Dynamic", "[", 
             RowBox[{
              RowBox[{"globalThreads", "=", "threadAssociation"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Length", "/@", "threadAssociation"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"EventHandler", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Dynamic", "[", "\[IndentingNewLine]", 
               RowBox[{"scol", "[", "threadAssociation", "]"}], " ", "]"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{"\"\<MouseDown\>\"", ":>", 
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"point", "=", " ", 
                  RowBox[{"Round", "/@", 
                   RowBox[{
                   "MousePosition", "[", "\"\<Graphics\>\"", "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"threadAssociation", "=", 
                  RowBox[{"addPointToThread", "[", 
                   RowBox[{"threadAssociation", ",", "point"}], "]"}]}], 
                 ";"}], "\[IndentingNewLine]", ")"}]}]}], "]"}]}], 
           "\[IndentingNewLine]", "}"}]}]}], "]"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, 3.945665114884842*^9, {3.94566514666432*^9, 
   3.9456651477105293`*^9}, {3.945665346443907*^9, 3.9456653759522114`*^9}, {
   3.9456654723528175`*^9, 3.9456655545482407`*^9}, {3.945665679671007*^9, 
   3.945665682407669*^9}, {3.94566573008259*^9, 3.945665779611809*^9}, {
   3.945665930114311*^9, 3.945665931734743*^9}, {3.945665969515066*^9, 
   3.9456659738494263`*^9}, {3.9456663418385754`*^9, 3.9456663543482494`*^9}, 
   3.945666389210701*^9, {3.9456664591987114`*^9, 3.945666500678274*^9}, {
   3.945666641767973*^9, 3.9456666428328533`*^9}, 3.9456668938649445`*^9, {
   3.945667010431303*^9, 3.9456670123089504`*^9}, {3.945667268305464*^9, 
   3.945667294211895*^9}, {3.945667328404913*^9, 3.9456674373115654`*^9}, {
   3.9456675249973793`*^9, 3.9456675977916813`*^9}},
 CellLabel->"In[11]:=",ExpressionUUID->"12139abc-4552-7c49-8737-e3a3a50536dd"],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{"pointCollector", "[", "]"}], "\[IndentingNewLine]", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.9456674027275085`*^9, 3.945667406087099*^9}, {
  3.945748320175453*^9, 3.945748324528059*^9}},
 CellLabel->"In[73]:=",ExpressionUUID->"cd3f3d1d-c737-3942-9f37-a43a7a59a6c6"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9456689054823875`*^9, 3.9456689360429306`*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"a13737a9-301e-434e-9ad1-d660683b078c"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "format", " ", "of", " ", "the", " ", "threads", " ", "data", " ", 
   "continues", " ", "to", " ", "evolve"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.945748346455372*^9, 3.945748360734501*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"56ad7643-db9e-284b-8fa7-806eff6f5caa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"enumerate", "[", "list_", "]"}], " ", ":=", " ", 
     RowBox[{"Association", "@", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "list", "]"}], "]"}], "->", "list"}], 
       "]"}]}]}], ";", 
    RowBox[{
     RowBox[{"makePointsFromThreads", "[", "threadAssociation_", "]"}], " ", ":=",
      " ", 
     RowBox[{"enumerate", "[", 
      RowBox[{"Join", "@@", 
       RowBox[{"Values", "@", "threadAssociation"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"seeds", " ", "=", " ", 
     RowBox[{"makePointsFromThreads", " ", "[", "globalThreads", "]"}]}], ";",
     "\[IndentingNewLine]", 
    RowBox[{"seedLookup", "=", 
     RowBox[{"Association", "@", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"Values", "[", "seeds", "]"}], "->", 
        RowBox[{"Keys", "[", "seeds", "]"}]}], "]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"threads", "=", " ", 
     RowBox[{"Map", "[", 
      RowBox[{"seedLookup", ",", "globalThreads", ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"threads", "=", 
     RowBox[{"KeyValueMap", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<Family\>\"", "->", "1"}], ",", 
          RowBox[{"\"\<ThreadID\>\"", "->", "#1"}], ",", 
          RowBox[{"\"\<ThreadNodes\>\"", "->", "#2"}]}], "|>"}], "&"}], ",", 
       "threads"}], "]"}]}], ";"}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.9456687101737423`*^9, 3.9456688899375*^9}, {
   3.9456689380977383`*^9, 3.945668952392124*^9}, {3.9456689882074604`*^9, 
   3.9456689933746033`*^9}, {3.9456692200463085`*^9, 
   3.9456692334544067`*^9}, {3.9456694076650944`*^9, 
   3.9456694080324383`*^9}, {3.945672936440607*^9, 3.945673013780161*^9}, 
   3.9456730915626183`*^9, {3.9457494690598297`*^9, 3.9457494727995396`*^9}, {
   3.94575021255287*^9, 3.945750215097929*^9}},
 CellLabel->"In[76]:=",ExpressionUUID->"fbc371fa-c3f0-fc43-b3e8-642932d64ed2"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"fom", "[", "x_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "x", "]"}], ">", "0"}], ",", 
      RowBox[{"First", "[", "x", "]"}], ",", 
      RowBox[{"Missing", "[", "x", "]"}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945673042757551*^9, 3.9456730567655163`*^9}, {
   3.9456734741853123`*^9, 3.945673499146988*^9}, 3.945750447946501*^9},
 CellLabel->"In[12]:=",ExpressionUUID->"441aa0ed-bca7-6c41-ab41-482c54a4b363"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"pointPicker", "[", "head667", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.9456742812045555`*^9, 3.9456742819955673`*^9}, 
   3.9457506501334915`*^9},
 CellLabel->"In[78]:=",ExpressionUUID->"d3c49b90-8c65-7a44-b77b-807451883e73"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Make graph from seed positions", "Section",
 CellChangeTimes->{{3.945753588537342*^9, 
  3.9457535973322334`*^9}},ExpressionUUID->"b0dadcd5-de9f-3d44-a928-\
891839f882eb"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "check", " ", "we", " ", "didnt", " ", "muck", " ", "up", " ", "the", " ", 
    "mesh"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.945754073733261*^9, 3.945754097104357*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"45142eeb-ddcd-a44e-b2db-2f91040cf68f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"nodes", "=", 
     RowBox[{"Values", "@", 
      RowBox[{"head667", "[", "\"\<Seeds\>\"", "]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"mesh", " ", "=", " ", 
     RowBox[{"DelaunayMesh", "[", "nodes", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Show", "[", 
       RowBox[{"mesh", ",", 
        RowBox[{"graphicsHeadLines", "[", 
         RowBox[{"head667", ",", "1"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
      RowBox[{"head667", "[", "\"\<Mesh\>\"", "]"}]}], "=", "mesh"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"head667", "[", "\"\<Graph\>\"", "]"}], "=", 
     RowBox[{"graphFromMesh", "[", "mesh", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"head667", "[", "\"\<Graph\>\"", "]"}], "=", 
     RowBox[{"addBoundaryCoordinatesToGraph", "[", 
      RowBox[{"head667", "[", "\"\<Graph\>\"", "]"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"head667", "=", 
     RowBox[{"addThreadEdges", "[", "head667", "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"saveHead", "[", "head667", "]"}]}], "\[IndentingNewLine]", 
   "*)"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.945760129590185*^9, 3.9457601438363686`*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"8dc8c140-6b1b-8b40-998f-c1a1ef01c98c"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"graphFromMesh", "[", "mesh_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", ",", "pts", ",", "edges", ",", "ptXY"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"g", "=", 
       RowBox[{"MeshConnectivityGraph", "[", 
        RowBox[{"mesh", ",", "0"}], "]"}]}], ";", 
      RowBox[{"pts", "=", 
       RowBox[{"Last", "/@", 
        RowBox[{"VertexList", "[", "g", "]"}]}]}], ";", 
      RowBox[{"edges", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"Last", ",", 
         RowBox[{"EdgeList", "[", "g", "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", 
      RowBox[{"ptXY", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#1", "\[Rule]", 
           RowBox[{"AnnotationValue", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"g", ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "#1"}], "}"}]}], "}"}], ",", 
             "VertexCoordinates"}], "]"}]}], "&"}], ")"}], "/@", "pts"}]}], 
      ";", 
      RowBox[{"g", "=", 
       RowBox[{"Graph", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Tooltip", "[", 
             RowBox[{"#1", ",", "#1"}], "]"}], "&"}], ")"}], "/@", "pts"}], 
         ",", "edges", ",", 
         RowBox[{"VertexCoordinates", "\[Rule]", "ptXY"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "g"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.943772872878481*^9, 3.9437731028522263`*^9}, {
   3.9437731331391315`*^9, 3.9437732195946083`*^9}, {3.9437773744341507`*^9, 
   3.9437774026605854`*^9}, {3.943779899373556*^9, 3.943779902913494*^9}, {
   3.9437802488716908`*^9, 3.9437802527331524`*^9}, {3.9437804098553677`*^9, 
   3.9437804314939575`*^9}, {3.9437804614952793`*^9, 3.943780493298031*^9}, {
   3.943780533199354*^9, 3.943780535391716*^9}, {3.943780568161869*^9, 
   3.9437806263874454`*^9}, {3.9437806634207897`*^9, 
   3.9437807303717785`*^9}, {3.943780893474066*^9, 3.9437809058564167`*^9}, 
   3.9437809865922623`*^9, {3.94387413993738*^9, 3.9438741442185993`*^9}, {
   3.9438741805720425`*^9, 3.943874183484785*^9}, {3.943909374544676*^9, 
   3.9439093774899864`*^9}, 3.943909409792324*^9, {3.943909482582979*^9, 
   3.9439097329423847`*^9}, {3.9439097771779575`*^9, 3.943910045598751*^9}, {
   3.9439102885996876`*^9, 3.9439104349642334`*^9}, {3.9439104657740765`*^9, 
   3.943910942447691*^9}, {3.9439110311864643`*^9, 3.9439110313192444`*^9}, {
   3.943911428154831*^9, 3.9439114283995323`*^9}, {3.9439115368724155`*^9, 
   3.943911607209612*^9}, {3.943911696520607*^9, 3.943911713305809*^9}, {
   3.943911749261503*^9, 3.943911767175398*^9}, {3.9439118333504715`*^9, 
   3.943912521355318*^9}, {3.9439126337240887`*^9, 3.943912745085703*^9}, {
   3.943912779022827*^9, 3.9439130459067745`*^9}, {3.9439133079543285`*^9, 
   3.9439136409669304`*^9}, {3.943915209662901*^9, 3.94391528673839*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"4992593c-022c-2749-b50f-7885a4e3944c"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.945754325896761*^9, 3.9457543448787136`*^9}, {
   3.9457543838146*^9, 3.945754456311802*^9}, {3.945756307531389*^9, 
   3.945756326705534*^9}, {3.945760052081724*^9, 3.945760086919916*^9}, 
   3.9457601274159737`*^9},
 CellLabel->"In[82]:=",ExpressionUUID->"38a8d89f-9d05-7b4e-ab82-a3e8ff1c8912"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9457533047906437`*^9, 3.9457533100352383`*^9}, {
  3.945753604145323*^9, 3.9457536163787994`*^9}, {3.9457537553014183`*^9, 
  3.9457537799236393`*^9}, {3.9457541068291664`*^9, 3.9457541180332546`*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"495867c4-4793-b348-aee5-9255f316209b"],

Cell[CellGroupData[{

Cell["Boundary finding", "Subsubsection",
 CellChangeTimes->{{3.945754699327009*^9, 3.945754709753687*^9}, 
   3.945754932245558*^9},ExpressionUUID->"3e18dcb0-1ae4-854c-8baa-\
e7fb26beaedf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"boundaryGraph", "[", "graph_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "leftMostNode", ",", "leftMostEdge", ",", "res", ",", "pathAsEdges"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"leftMostNode", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"VertexList", "[", "graph", "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"AnnotationValue", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"graph", ",", "#"}], "}"}], ",", "VertexCoordinates"}],
              "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"leftMostEdge", " ", "=", " ", 
       RowBox[{"fom", "@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"centredVertexList", "[", 
           RowBox[{"graph", ",", "leftMostNode"}], "]"}], ",", 
          RowBox[{
           RowBox[{"edgeClockTime", "[", 
            RowBox[{"graph", ",", "#"}], "]"}], "&"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "leftMostEdge", "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"Missing", "[", "\"\<No edges left\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"pathAsEdges", "=", 
       RowBox[{"Catch", "[", 
        RowBox[{"Nest", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"nextPath", "[", 
            RowBox[{"graph", ",", "#"}], "]"}], "&"}], ",", 
          RowBox[{"{", "leftMostEdge", "}"}], ",", "1000"}], "]"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"pathAsEdges", "=", 
       RowBox[{"orderUndirectedEdges", "[", "pathAsEdges", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"subGraphEdgesOnly", "[", 
        RowBox[{"graph", ",", "pathAsEdges"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"Graph", "[", 
        RowBox[{"res", ",", 
         RowBox[{"EdgeShapeFunction", "->", 
          RowBox[{"{", "\"\<Arrow\>\"", "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"centredVertexList", "[", 
    RowBox[{"graph_", ",", "v_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"unsortedEdgeList", ",", "otherVertices"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"unsortedEdgeList", "=", " ", 
       RowBox[{"EdgeList", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"v", "\[UndirectedEdge]", "_"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"otherVertices", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"List", "@@@", "unsortedEdgeList"}], "]"}], ",", 
         RowBox[{"{", "v", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"v", "\[UndirectedEdge]", "#"}], "&"}], ",", 
        "otherVertices"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"edgeClockTime", "[", 
    RowBox[{"graph_", ",", "edge_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v1", ",", "v2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"v1", ",", "v2"}], "}"}], "=", 
       RowBox[{"N", "@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"AnnotationValue", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"graph", ",", "#"}], "}"}], ",", "VertexCoordinates"}], 
            "]"}], "&"}], ",", 
          RowBox[{"List", "@@", "edge"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"12", "*", 
       RowBox[{
        RowBox[{"Mod", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Pi]", "/", "2"}], "-", 
           RowBox[{"ArcTan", "@@", 
            RowBox[{"(", 
             RowBox[{"v2", "-", "v1"}], ")"}]}]}], ",", 
          RowBox[{"2", "\[Pi]"}]}], "]"}], "/", 
        RowBox[{"(", 
         RowBox[{"2", "\[Pi]"}], ")"}]}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"edgeClockTime", "[", 
    RowBox[{"graph_", ",", "edge1_", ",", "edge2_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"t1", ",", "t2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t1", "=", 
       RowBox[{"edgeClockTime", "[", 
        RowBox[{"graph", ",", "edge1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t2", "=", 
       RowBox[{"edgeClockTime", "[", 
        RowBox[{"graph", ",", "edge2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Mod", "[", 
       RowBox[{
        RowBox[{"t2", "-", "t1", "-", "6"}], ",", "12"}], "]"}]}]}], " ", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"so", " ", 
       RowBox[{"time", "[", " ", 
        RowBox[{
         RowBox[{"a", "\[UndirectedEdge]", "b"}], ",", " ", 
         RowBox[{"b", "\[UndirectedEdge]", "a"}]}], "]"}]}], " ", "=", "0"}], 
     "*)"}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"edgeDeviation", "[", 
    RowBox[{"graph_", ",", "edge1_", ",", "edge2_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "edgeTime", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"edgeTime", "=", 
       RowBox[{"edgeClockTime", "[", 
        RowBox[{"graph", ",", "edge1", ",", "edge2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Abs", "[", 
       RowBox[{"edgeTime", "-", "6"}], "]"}]}]}], " ", "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nextPath", "[", 
    RowBox[{"graph_", ",", "path_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "n", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"nextEdgeByClockTime", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"Last", "[", "path", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "n", "]"}], ",", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<No nxt node\>\"", "]"}], ";"}], "*)"}], 
        RowBox[{"Throw", "[", "path", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{"path", ",", "n"}], "]"}], ",", 
        RowBox[{"Throw", "[", "path", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Append", "[", 
       RowBox[{"path", ",", "n"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nextEdgeByClockTime", "[", 
    RowBox[{"graph_", ",", 
     RowBox[{"v1_", "\[UndirectedEdge]", "v2_"}]}], "]"}], " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"es", ",", "nextv"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"es", "=", 
       RowBox[{"nextEdgesByClockTime", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"v1", "\[UndirectedEdge]", "v2"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"es", "=", 
       RowBox[{"KeyDrop", "[", 
        RowBox[{"es", ",", 
         RowBox[{"v2", " ", "\[UndirectedEdge]", " ", "v1"}]}], "]"}]}], " ", 
      ";", 
      RowBox[{"(*", " ", 
       RowBox[{"reverse", " ", "edge"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"fom", "[", 
       RowBox[{"Keys", "[", "es", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nextEdgesByClockTime", "[", 
     RowBox[{"graph_", ",", 
      RowBox[{"v1_", "\[UndirectedEdge]", "v2_"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Sort", "@", 
     RowBox[{"Association", "@", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "->", 
          RowBox[{"edgeClockTime", "[", 
           RowBox[{"graph", ",", 
            RowBox[{"v1", "\[UndirectedEdge]", "v2"}], ",", "#"}], "]"}]}], 
         "&"}], ",", "\[IndentingNewLine]", 
        RowBox[{"centredVertexList", "[", 
         RowBox[{"graph", ",", "v2"}], "]"}]}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"orderUndirectedEdges", "[", "chain_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lastb", ",", "examinePair"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"lastb", "=", 
       RowBox[{"chain", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"examinePair", "[", 
        RowBox[{"a_", "\[UndirectedEdge]", "b_"}], "]"}], " ", ":=", " ", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", "res", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", "=", " ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"a", "=!=", "lastb"}], ",", 
             RowBox[{"b", "\[DirectedEdge]", "a"}], ",", 
             RowBox[{"a", "\[DirectedEdge]", "b"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"lastb", "=", "b"}], ";", "\[IndentingNewLine]", "res"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Map", "[", 
       RowBox[{"examinePair", ",", "chain"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"subGraphEdgesOnly", "[", 
    RowBox[{"graph_", ",", "sg_Graph"}], "]"}], ":=", "  ", 
   RowBox[{"subGraphEdgesOnly", "[", 
    RowBox[{"graph", ",", 
     RowBox[{"EdgeList", "[", "sg", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"subGraphEdgesOnly", "[", 
    RowBox[{"graph_", ",", "edges_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", ",", "e"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"g", "=", 
       RowBox[{"EdgeDelete", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"EdgeList", "[", "graph", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"g", "=", " ", 
       RowBox[{"EdgeAdd", "[", 
        RowBox[{"g", ",", "edges"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"g", "=", 
       RowBox[{"Subgraph", "[", 
        RowBox[{"g", ",", "edges"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "g"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"stripBoundary", "[", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"\"\<Graph\>\"", "->", "graph_"}], ",", "___", ",", 
      RowBox[{"\"\<Level\>\"", "->", "level_"}], ",", "___"}], "|>"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"bge", ",", "remainder", ",", "bv", ",", "bg"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bge", "=", 
       RowBox[{"boundaryGraphEdges", "[", "graph", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "bge", "]"}], ",", 
        RowBox[{"Return", "[", "bge", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bv", "=", " ", 
       RowBox[{"VertexList", "[", 
        RowBox[{"Graph", "[", "bge", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"remainder", "=", 
       RowBox[{"Subgraph", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"VertexList", "[", "graph", "]"}], ",", "bv"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bg", "=", " ", 
       RowBox[{"subGraphEdgesOnly", "[", 
        RowBox[{"graph", ",", "bge"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<Graph\>\"", "->", "remainder"}], ",", 
        RowBox[{"\"\<Level\>\"", "->", 
         RowBox[{"level", "+", "1"}]}], ",", 
        RowBox[{"\"\<Boundary\>\"", "->", "bg"}], ",", 
        RowBox[{"\"\<BoundaryDirectedEdges\>\"", "->", "bge"}]}], "|>"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"boundaryGraphEdges", "[", "graph_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", ",", "e"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"g", "=", 
       RowBox[{"boundaryGraph", "[", "graph", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "g", "]"}], ",", 
        RowBox[{"Return", "[", "g", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"e", "=", 
       RowBox[{"FindCycle", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fom", "@", "e"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nodeBoundaryCoordinatesLookupLevel", "[", 
    RowBox[{"graphBoundaryList_", ",", "level_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", ",", "v", ",", "np"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"g", "=", 
       RowBox[{"graphBoundaryList", "[", 
        RowBox[{"[", "level", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"v", "=", 
       RowBox[{"VertexList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"np", "=", 
       RowBox[{"Length", "[", "v", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"[", "nodeix", "]"}], "]"}], "->", 
          RowBox[{"<|", 
           RowBox[{
            RowBox[{"\"\<Node\>\"", "->", 
             RowBox[{"v", "[", 
              RowBox[{"[", "nodeix", "]"}], "]"}]}], ",", 
            RowBox[{"\"\<Level\>\"", "->", "level"}], ",", 
            RowBox[{"\"\<Y\>\"", "->", "nodeix"}], ",", 
            RowBox[{"\"\<adjacentY\>\"", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"nodeix", "==", "1"}], ",", "np", ",", 
                 RowBox[{"nodeix", "-", "1"}]}], "]"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"nodeix", "==", "np"}], ",", "1", ",", 
                 RowBox[{"nodeix", "+", "1"}]}], "]"}]}], "}"}]}]}], 
           "\[IndentingNewLine]", "|>"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"nodeix", ",", "np"}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
    "makeNodeBoundaryCoordinatesLookup", "[", "graphBoundaryList_", "]"}], ":=",
     "\[IndentingNewLine]", 
    RowBox[{"Join", "@@", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"nodeBoundaryCoordinatesLookupLevel", "[", 
         RowBox[{"graphBoundaryList", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"Range", "[", 
        RowBox[{"Length", "[", "graphBoundaryList", "]"}], "]"}]}], "]"}]}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeBoundaryCoordinates", "[", "graph_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "stripResults", ",", "boundaryCoordinateLength", ",", 
        "graphBoundaryList", ",", "boundaryCoordinatesLookup"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"stripResults", "=", 
        RowBox[{"DeleteMissing", "@", 
         RowBox[{"NestWhileList", "[", 
          RowBox[{"stripBoundary", ",", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<Graph\>\"", "->", "graph"}], ",", 
             RowBox[{"\"\<Boundary\>\"", "->", "_"}], ",", 
             RowBox[{"\"\<Level\>\"", "->", "0"}]}], "|>"}], ",", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"MissingQ", "[", "#", "]"}]}], "&"}], ",", "1", ",", 
           "20"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"graphBoundaryList", " ", "=", 
        RowBox[{"Drop", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#Boundary", "&"}], "/@", "stripResults"}], ",", "1"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"boundaryCoordinatesLookup", " ", "=", 
        RowBox[{
        "makeNodeBoundaryCoordinatesLookup", "[", "graphBoundaryList", 
         "]"}]}], ";", "\[IndentingNewLine]", "boundaryCoordinatesLookup"}]}],
      "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"addBoundaryCoordinatesToGraph", "[", "graphArg_", "]"}], " ", ":=",
   " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"graph", "=", "graphArg"}], ",", "bc"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bc", "=", 
      RowBox[{"makeBoundaryCoordinates", "[", "graph", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AnnotationValue", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"graph", ",", "#"}], "}"}], ",", 
            "\"\<BoundaryCoordinates\>\""}], "]"}], "=", 
          RowBox[{"bc", "[", "#", "]"}]}], ")"}], "&"}], ",", 
       RowBox[{"VertexList", "[", "graph", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "graph"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945754763657177*^9, 3.9457548493594646`*^9}, {
   3.945754885060669*^9, 3.9457548945819454`*^9}, {3.945754965125086*^9, 
   3.9457549964872513`*^9}, {3.9457550632338905`*^9, 3.94575517354949*^9}, {
   3.94575520369199*^9, 3.945755208080597*^9}, 3.9457559574242783`*^9, {
   3.9457562764069805`*^9, 3.9457562909572487`*^9}, {3.9457617663210793`*^9, 
   3.945761766667488*^9}},
 CellLabel->"In[14]:=",ExpressionUUID->"d5c42315-0f73-684c-8a65-0ae1dabcb262"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9457537482760143`*^9, 3.945753750382475*^9}},
 CellLabel->
  "In[101]:=",ExpressionUUID->"ea4093f8-0330-ca40-b627-280357e5be92"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Thread finding", "Subsection",
 CellChangeTimes->{{3.945757612116579*^9, 
  3.9457576251179924`*^9}},ExpressionUUID->"80c58c00-d75d-6647-8416-\
6dad1e12edfb"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.9457576353421993`*^9, 3.945757658226799*^9}, 
   3.945760045386959*^9},
 CellLabel->
  "In[102]:=",ExpressionUUID->"25c40d68-3108-fa4d-bfbc-264b481d02fe"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"nodeOrdering", "[", 
      RowBox[{"graph_", ",", "a_", ",", "b_"}], "]"}], ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "bc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"bc", "[", "node_", "]"}], " ", ":=", " ", 
         RowBox[{"AnnotationValue", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"graph", ",", "node"}], "}"}], ",", 
           "\"\<BoundaryCoordinates\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MissingQ", "[", 
            RowBox[{"bc", "[", "a", "]"}], "]"}], "||", " ", 
           RowBox[{"MissingQ", "[", 
            RowBox[{
             RowBox[{"bc", "[", "a", "]"}], "[", "\"\<Level\>\"", "]"}], 
            "]"}]}], ",", 
          RowBox[{"Return", "[", "False", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MissingQ", "[", 
            RowBox[{"bc", "[", "b", "]"}], "]"}], "||", " ", 
           RowBox[{"MissingQ", "[", 
            RowBox[{
             RowBox[{"bc", "[", "b", "]"}], "[", "\"\<Level\>\"", "]"}], 
            "]"}]}], ",", 
          RowBox[{"Return", "[", "True", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"bc", "[", "a", "]"}], "[", "\"\<Level\>\"", "]"}], "<", 
           "  ", 
           RowBox[{
            RowBox[{"bc", "[", "b", "]"}], "[", "\"\<Level\>\"", "]"}]}], ",", 
          RowBox[{"Return", "[", "True", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"bc", "[", "b", "]"}], "[", "\"\<Y\>\"", "]"}], "==", 
            "1"}], " ", "&&", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"bc", "[", "a", "]"}], "[", "\"\<Y\>\"", "]"}], "==", 
            RowBox[{
             RowBox[{
              RowBox[{"bc", "[", "b", "]"}], "[", "\"\<adjacentY\>\"", "]"}], 
             "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
          RowBox[{"Return", "[", "True", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"bc", "[", "a", "]"}], "[", "\"\<Y\>\"", "]"}], "<", " ", 
          RowBox[{
           RowBox[{"bc", "[", "b", "]"}], "[", "\"\<Y\>\"", "]"}]}], "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sortEdge", "[", 
      RowBox[{"graph_", ",", 
       RowBox[{"a_", "\[UndirectedEdge]", "b_"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "pair", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pair", "=", 
         RowBox[{"{", 
          RowBox[{"a", ",", "b"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pair", " ", "=", " ", 
         RowBox[{"Sort", "[", 
          RowBox[{"pair", ",", 
           RowBox[{
            RowBox[{"nodeOrdering", "[", 
             RowBox[{"graph", ",", "#1", ",", "#2"}], "]"}], "&"}]}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"UndirectedEdge", "@@", "pair"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeSortedThreadEdges", "[", 
      RowBox[{"graph_", ",", "thread_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", ",", "edges"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"g", "=", 
         RowBox[{"Subgraph", "[", 
          RowBox[{"graph", ",", 
           RowBox[{"thread", "[", "\"\<ThreadNodes\>\"", "]"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"edges", " ", "=", " ", 
         RowBox[{"EdgeList", "[", "g", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"nodeOrdering", "[", 
           RowBox[{"graph", ",", 
            RowBox[{"edges", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"edges", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"-", "1"}], ",", 
               RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", "edges", ",", 
          RowBox[{"Reverse", "/@", 
           RowBox[{"(", 
            RowBox[{"Reverse", "[", "edges", "]"}], ")"}]}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"addThreadEdges", "[", "head_", "]"}], ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"res", "=", "head"}], ",", "threads"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"threads", "=", 
         RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"threads", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Append", "[", 
             RowBox[{"#", ",", 
              RowBox[{"\"\<ThreadEdges\>\"", "->", 
               RowBox[{"makeSortedThreadEdges", "[", 
                RowBox[{
                 RowBox[{"head", "[", "\"\<Graph\>\"", "]"}], ",", "#"}], 
                "]"}]}]}], "]"}], "&"}], ",", "threads"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", "[", "\"\<Threads\>\"", "]"}], "=", "threads"}], ";", 
        "\[IndentingNewLine]", "res"}]}], " ", "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9457580559899197`*^9, 3.9457580793317738`*^9}, {
  3.945758141427948*^9, 3.945758183109398*^9}, {3.94575826031711*^9, 
  3.945758278238802*^9}, {3.9457583981081963`*^9, 3.9457586368834686`*^9}, {
  3.945758671664343*^9, 3.9457587498203735`*^9}, {3.9457587852378807`*^9, 
  3.945758787097391*^9}, {3.94575883660116*^9, 3.9457589782703304`*^9}, {
  3.9457590198815746`*^9, 3.9457590341619225`*^9}, {3.945759189442396*^9, 
  3.9457592851290073`*^9}, {3.9457593381604404`*^9, 3.9457596504136734`*^9}, {
  3.9457597550822697`*^9, 3.945759783491453*^9}, {3.945759824742277*^9, 
  3.9457598527410583`*^9}, {3.9457599323117847`*^9, 3.9457600048353004`*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"38f4ab7b-3ffd-4a40-9581-381691b955d1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"threadsSeededAt", "[", 
     RowBox[{"graph_", ",", "a_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "edgePairs", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"edgePairs", "=", 
        RowBox[{"edgeMatch", "[", 
         RowBox[{"graph", ",", "a"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"threads", "=", 
        RowBox[{"Association", "@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "->", 
             RowBox[{"extendThreadFromSeed", "[", 
              RowBox[{"graph", ",", "#"}], "]"}]}], "&"}], ",", "edgePairs"}],
           "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"extendThreadFromSeed", "[", 
     RowBox[{"graph_", ",", "seed_"}], "]"}], " ", ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "thread", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"thread", " ", "=", " ", 
        RowBox[{"Catch", "[", 
         RowBox[{"Nest", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"findNextEdgeInThread", "[", 
             RowBox[{"graph", ",", "#", ",", "\"\<Inwards\>\""}], "]"}], 
            "&"}], ",", "seed", ",", "100"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"thread", " ", "=", " ", 
        RowBox[{"Catch", "[", 
         RowBox[{"Nest", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"findNextEdgeInThread", "[", 
             RowBox[{"graph", ",", "#", ",", "\"\<Outwards\>\""}], "]"}], 
            "&"}], ",", "thread", ",", "100"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "thread"}]}], " ", "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"findNextEdgeInThread", "[", 
     RowBox[{"graph_", ",", "thread_", ",", "direction_"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "lastEdge", ",", "lastNode", ",", "nextNodes", ",", "bottomLevel", ",",
         "level"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bottomLevel", " ", "=", " ", 
        RowBox[{"Max", "@", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{"#Level", "&"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"DeleteMissing", "[", 
              RowBox[{"AnnotationValue", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"graph", ",", "#"}], "}"}], ",", 
                "\"\<BoundaryCoordinates\>\""}], "]"}], "]"}], "&"}], "/@", 
            RowBox[{"VertexList", "[", "graph", "]"}]}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lastEdge", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"direction", "==", "\"\<Inwards\>\""}], ",", 
          RowBox[{"Last", "[", "thread", "]"}], ",", 
          RowBox[{"First", "[", "thread", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"lastNode", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"direction", "==", "\"\<Inwards\>\""}], ",", 
          RowBox[{"Last", "[", "lastEdge", "]"}], ",", 
          RowBox[{"First", "[", "lastEdge", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nextNodes", "=", " ", 
        RowBox[{"AdjacencyList", "[", 
         RowBox[{"graph", ",", "lastNode"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"Map", "[", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<LastNode\>\"", "->", "lastNode"}], ",", 
             RowBox[{"\"\<NextNode\>\"", "->", "#"}], ",", 
             RowBox[{"\"\<NextEdge\>\"", "->", " ", 
              RowBox[{"If", " ", "[", 
               RowBox[{
                RowBox[{"direction", "==", "\"\<Inwards\>\""}], ",", 
                RowBox[{"lastNode", " ", "\[UndirectedEdge]", " ", "#"}], ",", 
                RowBox[{"#", "\[UndirectedEdge]", "lastNode"}]}], "]"}]}]}], 
            "|>"}], "&"}], ",", "nextNodes"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"#", ",", 
             RowBox[{"\"\<Deviation\>\"", "->", 
              RowBox[{"edgeDeviation", "[", 
               RowBox[{"graph", ",", "lastEdge", ",", "#NextEdge"}], 
               "]"}]}]}], "]"}], "&"}], ",", "res"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"res", ",", 
          RowBox[{
           RowBox[{"#Deviation", "<", "1"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"fom", "@", "res"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MissingQ", "[", "res", "]"}], ",", 
         RowBox[{"Throw", "[", "thread", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nextNode", "=", " ", 
        RowBox[{"fom", "@", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"List", "@@", 
            RowBox[{"res", "[", "\"\<NextEdge\>\"", "]"}]}], ",", 
           RowBox[{"{", "lastNode", "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"level", " ", "=", " ", 
        RowBox[{"AnnotationValue", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"graph", ",", "nextNode"}], "}"}], ",", 
          "\"\<BoundaryCoordinates\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MissingQ", "[", "level", "]"}], ",", 
         RowBox[{"Throw", "[", "thread", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"level", "[", "\"\<Level\>\"", "]"}], "==", "1"}], ",", 
         RowBox[{"Throw", "[", "thread", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"level", "[", "\"\<Level\>\"", "]"}], "==", "bottomLevel"}],
          ",", 
         RowBox[{"Throw", "[", "thread", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"res", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"direction", "==", "\"\<Inwards\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Append", "[", 
           RowBox[{"thread", ",", 
            RowBox[{"res", "[", "\"\<NextEdge\>\"", "]"}]}], "]"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{"Prepend", "[", 
           RowBox[{"thread", ",", 
            RowBox[{"res", "[", "\"\<NextEdge\>\"", "]"}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
       "res"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "pairs", " ", "of", " ", "edges", " ", "which", " ", "can", " ", "form", 
    " ", "threads"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"edgeMatch", "[", 
    RowBox[{"graph_", ",", "node_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ng", ",", "edges", ",", "refNode", ",", "level", ",", "nbrs", ",", 
       "nodeTimes", ",", "edgePairs", ",", "bc"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"edges", "=", 
       RowBox[{"EdgeList", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"_", "\[UndirectedEdge]", "node"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nbrs", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", 
          RowBox[{"Graph", "[", "edges", "]"}], "]"}], ",", 
         RowBox[{"{", "node", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bc", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "->", " ", 
            RowBox[{"AnnotationValue", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"graph", ",", "#"}], "}"}], ",", 
              "\"\<BoundaryCoordinates\>\""}], "]"}]}], "&"}], ",", "nbrs"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"EvenQ", "[", 
         RowBox[{"Length", "[", "nbrs", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"level", "=", 
          RowBox[{
           RowBox[{"bc", "[", "node", "]"}], "[", "\"\<Level\>\"", "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"refNode", "=", 
          RowBox[{"First", "[", "nbrs", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"nodeTimes", " ", "=", 
          RowBox[{"Association", "@", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"node", " ", "\[UndirectedEdge]", "#"}], " ", "->", 
               " ", 
               RowBox[{"edgeClockTime", "[", 
                RowBox[{"graph", ",", 
                 RowBox[{"refNode", " ", "\[UndirectedEdge]", " ", "node"}], 
                 ",", 
                 RowBox[{"node", " ", "\[UndirectedEdge]", "#"}]}], "]"}]}], 
              "&"}], ",", "nbrs"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"nodeTimes", "=", 
          RowBox[{"Sort", "[", "nodeTimes", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"edgePairs", "=", " ", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Keys", "[", "nodeTimes", "]"}], ",", 
             RowBox[{
              RowBox[{"Length", "[", "nbrs", "]"}], "/", "2"}]}], "]"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"edgePairs", " ", "=", " ", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"sortEdgeListByLevel", "[", 
              RowBox[{"graph", ",", "#"}], "]"}], "&"}], ",", "edgePairs"}], 
           "]"}]}]}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"by", " ", "construction"}], ",", " ", 
          RowBox[{
          "these", " ", "pairs", " ", "all", " ", "radiate", " ", "from", " ",
            "the", " ", "node"}]}], " ", "*)"}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"odd", " ", "#", " ", "of", " ", "edges"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<Nonhex \>\"", ",", " ", "node", ",", " ", "\"\< \>\"", ",", 
            RowBox[{"Length", "[", "nbrs", "]"}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", "*)"}], 
        RowBox[{"edgePairs", "=", 
         RowBox[{"edgeMatchByDeviation", "[", 
          RowBox[{"graph", ",", "node"}], "]"}]}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "edgePairs"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"edgeMatchByDeviation", "[", 
    RowBox[{"graph_", ",", "node_"}], "]"}], ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ng", ",", "edges", ",", "nbrs", ",", "edgePairs", ",", "maxPairs", ",",
        "leftOver", ",", "bc", ",", "edgePairDeviations"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"bc", "[", "n_", "]"}], ":=", "  ", 
       RowBox[{"AnnotationValue", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"graph", ",", "n"}], "}"}], ",", 
         "\"\<BoundaryCoordinates\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"edges", "=", 
       RowBox[{"EdgeList", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"_", "\[UndirectedEdge]", "node"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nbrs", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", 
          RowBox[{"Graph", "[", "edges", "]"}], "]"}], ",", 
         RowBox[{"{", "node", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"maxPairs", "=", 
       RowBox[{"Floor", "[", 
        RowBox[{
         RowBox[{"Length", "[", "nbrs", "]"}], "/", "2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"edgePairs", "=", " ", 
       RowBox[{"Subsets", "[", 
        RowBox[{"edges", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"edgePairDeviations", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "->", 
            RowBox[{"edgeDeviation", "[", 
             RowBox[{"graph", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], " ", "]"}]}], "&"}], ",", 
          "edgePairs"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"edgePairDeviations", "=", " ", 
       RowBox[{"Sort", "[", "edgePairDeviations", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"edgePairs", "=", 
       RowBox[{"Keys", "[", "edgePairDeviations", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"edgePairs", "=", " ", 
       RowBox[{"removeDuplicateEdges", "[", "edgePairs", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"edgePairs", "=", " ", 
       RowBox[{"Take", "[", 
        RowBox[{"edgePairs", ",", 
         RowBox[{"UpTo", "[", "maxPairs", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"edgePairDeviations", "[", 
          RowBox[{"Last", "[", "edgePairs", "]"}], "]"}], ">", "2"}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Large deviation \>\"", ",", "edgePairs"}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OddQ", "[", 
         RowBox[{"Length", "[", "nbrs", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"leftOver", "=", " ", 
          RowBox[{"List", "/@", 
           RowBox[{"Complement", "[", 
            RowBox[{"edges", ",", 
             RowBox[{"Flatten", "[", "edgePairs", "]"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"edgePairs", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"edgePairs", ",", "leftOver"}], "]"}]}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "edgePairs"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"removeDuplicateEdges", " ", "[", "edgePairList_", "]"}], " ", ":=",
    " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"used", ",", "i", ",", "nextPair"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"used", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"nextPair", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", 
         RowBox[{"Length", "[", "edgePairList", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"nextPair", "=", " ", 
          RowBox[{"Append", "[", 
           RowBox[{"nextPair", ",", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"edgePairList", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "used"}], "]"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"used", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"used", ",", 
            RowBox[{"edgePairList", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Select", "[", 
       RowBox[{"nextPair", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "#", "]"}], "==", "2"}], "&"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sortEdgeListByLevel", "[", 
    RowBox[{"graph_", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"node_", "\[UndirectedEdge]", "a_"}], ",", 
       RowBox[{"node_", " ", "\[UndirectedEdge]", "b_"}]}], "}"}]}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "bc", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"bc", "[", "n_", "]"}], ":=", "  ", 
       RowBox[{"AnnotationValue", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"graph", ",", "n"}], "}"}], ",", 
         "\"\<BoundaryCoordinates\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"bc", "[", "a", "]"}], "[", "\"\<Level\>\"", "]"}], "<", 
            " ", 
            RowBox[{
             RowBox[{"bc", "[", "b", "]"}], "[", "\"\<Level\>\"", "]"}]}], 
           " ", ")"}], "||", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"bc", "[", "a", "]"}], "[", "\"\<Level\>\"", "]"}], "==",
               " ", 
              RowBox[{
               RowBox[{"bc", "[", "b", "]"}], "[", "\"\<Level\>\"", "]"}]}], 
             ")"}], " ", "&&", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"bc", "[", "a", "]"}], "[", "\"\<Y\>\"", "]"}], "<", 
             " ", 
             RowBox[{
              RowBox[{"bc", "[", "b", "]"}], "[", "\"\<Y\>\"", "]"}]}]}], 
           ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"a", "\[UndirectedEdge]", "node"}], ",", 
           RowBox[{"node", " ", "\[UndirectedEdge]", "b"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"b", "\[UndirectedEdge]", "node"}], ",", 
           RowBox[{"node", " ", "\[UndirectedEdge]", "a"}]}], " ", "}"}]}], 
        "]"}], ")"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9457605150699673`*^9, 3.945760670540409*^9}, {
   3.9457607124812737`*^9, 3.9457607419203033`*^9}, {3.9457607735890656`*^9, 
   3.9457609612987404`*^9}, {3.945761213667492*^9, 3.9457612839191704`*^9}, {
   3.9457613201176643`*^9, 3.9457614002346*^9}, {3.9457615587232056`*^9, 
   3.9457615603214607`*^9}, {3.9457615951181545`*^9, 3.945761740415903*^9}, {
   3.945761788525036*^9, 3.945761907699936*^9}, {3.9457619614044456`*^9, 
   3.945762054133217*^9}, {3.945765308647255*^9, 3.9457654450475254`*^9}, 
   3.9457666505433197`*^9, {3.9457682253841705`*^9, 3.945768271051731*^9}, {
   3.9457683153512344`*^9, 3.945768331689745*^9}, {3.945768449255684*^9, 
   3.945768640191681*^9}, {3.9457687009254284`*^9, 3.9457687092420006`*^9}, {
   3.9457687531949825`*^9, 3.945768794280794*^9}, 3.945769135159981*^9, {
   3.945769183616976*^9, 3.9457693220033913`*^9}, {3.9457735474948635`*^9, 
   3.945773637580433*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"b364bb2a-df7e-2146-99a2-46b06372b9de"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Thread mangling", "Section",
 CellChangeTimes->{{3.9457506390082226`*^9, 
  3.945750643457468*^9}},ExpressionUUID->"d4512c37-5c80-bd40-99fc-\
a2b75f50348d"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"displayHead", "[", 
      RowBox[{
      "head_", ",", "currentFamily_", ",", "nearestNode_", ",", 
       "currentThread_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "nodesInThreads", ",", "threadList", ",", "lineNodes", ",", "linesXY",
          ",", "threadLines", ",", "node"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"threadList", "=", 
         RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"lineNodes", "=", 
         RowBox[{"Association", "@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#ThreadID", "->", 
              RowBox[{"#", "[", "\"\<ThreadNodes\>\"", "]"}]}], "&"}], ",", 
            "threadList"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"nodesInThreads", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{"head", "[", "\"\<Seeds\>\"", "]"}], ",", "lineNodes", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"linesXY", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Line", ",", "nodesInThreads"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pointsXY", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Point", ",", "nodesInThreads"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "nearestNode", "]"}], ",", 
          RowBox[{"node", "=", 
           RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"node", "=", 
           RowBox[{"{", 
            RowBox[{"Red", ",", 
             RowBox[{"PointSize", "[", "Large", "]"}], ",", 
             RowBox[{"Point", "[", 
              RowBox[{
               RowBox[{"head", "[", "\"\<Seeds\>\"", "]"}], "[", 
               "nearestNode", "]"}], "]"}]}], "}"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "currentThread", "]"}], ",", 
          RowBox[{"threadLines", "=", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"threadLines", "=", 
           RowBox[{"{", 
            RowBox[{"Red", ",", 
             RowBox[{"linesXY", "[", "currentThread", "]"}]}], "}"}]}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"displayHeadFamily", "[", 
           RowBox[{"head", ",", "currentFamily", ",", "300"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"node", "\[IndentingNewLine]", ",", "threadLines"}], 
            "\[IndentingNewLine]", "}"}], "]"}]}], "\[IndentingNewLine]", 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"displayHeadFamilies", "[", "head_", "]"}], " ", ":=", " ", 
     RowBox[{"Row", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"displayHeadFamily", "[", 
          RowBox[{"head", ",", "#"}], "]"}], "&"}], ",", 
        RowBox[{"familiesOfHead", "[", "head", "]"}]}], "]"}], "]"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"displayHeadFamily", "[", 
      RowBox[{"head_", ",", "familyID_", ",", 
       RowBox[{"imageSize_", ":", "150"}]}], "]"}], " ", ":=", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "nodesInThreads", ",", "threadList", ",", "lineNodes", ",", "linesXY",
          ",", "pointsXY"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"threadList", "=", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], ",", 
           RowBox[{
            RowBox[{"#Family", "==", "familyID"}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"lineNodes", "=", 
         RowBox[{"Association", "@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#ThreadID", "->", 
              RowBox[{"#", "[", "\"\<ThreadNodes\>\"", "]"}]}], "&"}], ",", 
            "threadList"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"nodesInThreads", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{"head", "[", "\"\<Seeds\>\"", "]"}], ",", "lineNodes", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"linesXY", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Line", ",", "nodesInThreads"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pointsXY", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Point", ",", "nodesInThreads"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Image", "[", 
           RowBox[{
            RowBox[{"head", "[", "\"\<Image\>\"", "]"}], ",", 
            RowBox[{"ImageSize", "->", "imageSize"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"LightBlue", ",", 
               RowBox[{"Values", "[", "linesXY", "]"}], ",", 
               RowBox[{"Values", "[", "pointsXY", "]"}]}], "}"}], ","}], 
            "\[IndentingNewLine]", "}"}], "]"}]}], "\[IndentingNewLine]", 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"graphicsHeadLines", "[", 
      RowBox[{"head_", ",", "familyID_", ",", 
       RowBox[{"imageSize_", ":", "150"}]}], "]"}], " ", ":=", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "nodesInThreads", ",", "threadList", ",", "lineNodes", ",", "linesXY",
          ",", "pointsXY"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"threadList", "=", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], ",", 
           RowBox[{
            RowBox[{"#Family", "==", "familyID"}], "&"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"lineNodes", "=", 
         RowBox[{"Association", "@", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"#ThreadID", "->", 
              RowBox[{"#", "[", "\"\<ThreadNodes\>\"", "]"}]}], "&"}], ",", 
            "threadList"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"nodesInThreads", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{"head", "[", "\"\<Seeds\>\"", "]"}], ",", "lineNodes", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"linesXY", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Line", ",", "nodesInThreads"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pointsXY", "=", 
         RowBox[{"Map", "[", 
          RowBox[{"Point", ",", "nodesInThreads"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Graphics", "[", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"LightBlue", ",", 
            RowBox[{"Values", "[", "linesXY", "]"}], ",", 
            RowBox[{"Values", "[", "pointsXY", "]"}]}], "}"}], 
          "\[IndentingNewLine]", "}"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"threadsThroughNode", "[", 
      RowBox[{
      "graph_", ",", "selectedNode_", ",", "nextNode_", ",", 
       "pruneTailNodes_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "threadPossibles", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "selectedNode", "]"}], ",", 
          RowBox[{"Return", "[", 
           RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"threadPossibles", " ", "=", " ", 
         RowBox[{"threadsSeededAt", "[", 
          RowBox[{"graph", ",", "selectedNode"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MissingQ", "[", "nextNode", "]"}], ",", 
          RowBox[{"Return", "[", "threadPossibles", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"threadPossibles", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"threadPossibles", ",", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"VertexList", "[", "#", "]"}], ",", "nextNode"}], "]"}],
             "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"threadPossibles", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Reverse", "@", 
             RowBox[{"Drop", "[", 
              RowBox[{
               RowBox[{"Reverse", "[", "#", "]"}], ",", 
               RowBox[{"UpTo", "[", "pruneTailNodes", "]"}]}], "]"}]}], "&"}],
            ",", "threadPossibles"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"threadPossibles", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"threadPossibles", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], ">", "0"}], "&"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", "threadPossibles"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"listCurrentPossibleEdgesThrough", "[", 
      RowBox[{"head_", ",", "builtFromNode_", ",", "throughNode_"}], "]"}], 
     " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", ",", "threadPossibleEdges"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"g", " ", "=", " ", 
         RowBox[{"EdgeDelete", "[", 
          RowBox[{
           RowBox[{"head", "[", "\"\<Graph\>\"", "]"}], ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"#ThreadEdges", "&"}], "/@", 
             RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"threadPossibleEdges", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Values", "@", 
           RowBox[{"threadsThroughNode", "[", 
            RowBox[{"g", ",", "builtFromNode", ",", "throughNode"}], 
            "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        "threadPossibleEdges"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"displayHeadThreads", "[", 
      RowBox[{"head_", ",", "displayThreadEdges_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"threadPossibles", ",", "threadPossibleEdges", ",", "g"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"g", " ", "=", " ", 
         RowBox[{"EdgeDelete", "[", 
          RowBox[{
           RowBox[{"head", "[", "\"\<Graph\>\"", "]"}], ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{"#ThreadEdges", "&"}], "/@", 
             RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Graphics", "[", 
           RowBox[{
            RowBox[{"Rectangle", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"ImageDimensions", "[", 
               RowBox[{"head", "[", "\"\<Image\>\"", "]"}], "]"}]}], "]"}], 
            ",", 
            RowBox[{"ImageSize", "->", "300"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Image", "[", 
           RowBox[{
            RowBox[{"head", "[", "\"\<Image\>\"", "]"}], ",", 
            RowBox[{"ImageSize", "->", "300"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"HighlightGraph", "[", 
           RowBox[{
            RowBox[{"Graph", "[", 
             RowBox[{"g", ",", 
              RowBox[{"BaseStyle", "->", "White"}]}], "]"}], ",", 
            "displayThreadEdges"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9456731769444942`*^9, 3.945673231263939*^9}, {
   3.9456732865236588`*^9, 3.945673348018915*^9}, {3.9456734096036205`*^9, 
   3.945673468761284*^9}, {3.9456735101741924`*^9, 3.945673606856634*^9}, {
   3.9456736585223866`*^9, 3.9456736760856647`*^9}, {3.9456737122682724`*^9, 
   3.945673726848261*^9}, {3.945673764769615*^9, 3.9456738110237026`*^9}, {
   3.945673870814207*^9, 3.945674146725212*^9}, {3.9456741775370464`*^9, 
   3.945674202181822*^9}, {3.9456743473729973`*^9, 3.94567435029846*^9}, {
   3.9456743900682697`*^9, 3.945674443332176*^9}, {3.945675007461361*^9, 
   3.9456750348308735`*^9}, 3.9456751269311504`*^9, {3.945675274133629*^9, 
   3.9456753439855595`*^9}, {3.945675432703453*^9, 3.9456754370347214`*^9}, {
   3.9456801537807007`*^9, 3.9456801557119675`*^9}, {3.945692338525879*^9, 
   3.9456923426848717`*^9}, {3.9456925751573143`*^9, 3.945692576713154*^9}, {
   3.945692612583994*^9, 3.945692613145281*^9}, {3.9456926943350105`*^9, 
   3.9456927447481976`*^9}, {3.9456927824936275`*^9, 3.945692874333679*^9}, {
   3.9456929355939617`*^9, 3.945692979155405*^9}, {3.9456931553810654`*^9, 
   3.94569316828421*^9}, {3.945695463904148*^9, 3.945695476691948*^9}, {
   3.9456955099020233`*^9, 3.9456956328518257`*^9}, {3.945695673596693*^9, 
   3.945695900557373*^9}, {3.945696137040327*^9, 3.9456961411182327`*^9}, {
   3.9456962024217663`*^9, 3.945696268437147*^9}, {3.9457530191060658`*^9, 
   3.945753023199848*^9}, {3.9457530595591507`*^9, 3.9457531548825245`*^9}, {
   3.945753844815584*^9, 3.94575385057889*^9}, {3.9457538893011303`*^9, 
   3.9457539389365444`*^9}, {3.945765728074915*^9, 3.9457658004622097`*^9}, {
   3.945765879198929*^9, 3.94576591520096*^9}, {3.9457659662279224`*^9, 
   3.9457660207013264`*^9}, {3.9457660989064655`*^9, 
   3.9457661315665607`*^9}, {3.9457663035446167`*^9, 3.945766381249748*^9}, {
   3.9457664440165653`*^9, 3.94576647960771*^9}, {3.945766666679493*^9, 
   3.945766677588684*^9}, {3.945766730700384*^9, 3.94576679743054*^9}, 
   3.945767042521942*^9, 3.9457674665623074`*^9, {3.945767517285433*^9, 
   3.945767563620388*^9}, {3.945767606244087*^9, 3.945767707444256*^9}, {
   3.945767746384342*^9, 3.945767786658127*^9}, {3.9457678416191463`*^9, 
   3.9457678729710007`*^9}, {3.945767924705942*^9, 3.945768005052677*^9}, {
   3.9457680700204887`*^9, 3.9457681254744873`*^9}, 3.9457682157543354`*^9, {
   3.945768854351797*^9, 3.945768865177761*^9}, {3.945768973366171*^9, 
   3.94576903576033*^9}, {3.9457690667214756`*^9, 3.945769071693613*^9}, {
   3.9457698437600975`*^9, 3.945769844429716*^9}, {3.945770383145344*^9, 
   3.945770452429268*^9}, {3.945770507492058*^9, 3.945770645476675*^9}, {
   3.945770707962803*^9, 3.9457707181975365`*^9}, {3.9457708050885754`*^9, 
   3.9457710029650974`*^9}, {3.945771064245983*^9, 3.9457710997422256`*^9}, {
   3.9457711647580776`*^9, 3.9457711671511135`*^9}, {3.945771201900099*^9, 
   3.9457712128233337`*^9}, {3.945772430392233*^9, 3.945772465041069*^9}, {
   3.9457725161514034`*^9, 3.945772537079529*^9}, 3.945787423852911*^9, {
   3.945787631446352*^9, 3.945787831883278*^9}, {3.945787871070242*^9, 
   3.9457878827083473`*^9}, {3.9457879373638935`*^9, 
   3.9457879520783005`*^9}, {3.945788109468092*^9, 3.945788131393633*^9}, {
   3.945788437619808*^9, 3.9457884540211163`*^9}, {3.945838617795212*^9, 
   3.9458386202816505`*^9}, {3.945838720781191*^9, 3.945838738432928*^9}, {
   3.945838768707611*^9, 3.9458389309842434`*^9}},
 CellLabel->
  "In[124]:=",ExpressionUUID->"38863b05-16ef-e546-8710-9122f85f1958"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Thread moving", "Section",
 CellChangeTimes->{{3.945754639045967*^9, 
  3.945754644093191*^9}},ExpressionUUID->"f4644541-54e7-5948-b270-\
40a5fd16d526"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"addFamily", "[", "head_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"res", "=", "head"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"res", "[", "\"\<FamilyCount\>\"", "]"}], "=", 
       RowBox[{
        RowBox[{"res", "[", "\"\<FamilyCount\>\"", "]"}], "+", "1"}]}], ";", 
      "res"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"familiesOfHead", "[", "head_", "]"}], ":=", 
   RowBox[{"Range", "[", 
    RowBox[{"head", "[", "\"\<FamilyCount\>\"", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"nextFamilyID", "[", 
     RowBox[{"head_", ",", "familyID_"}], "]"}], " ", ":=", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"familyID", ">=", 
       RowBox[{"head", "[", "\"\<FamilyCount\>\"", "]"}]}], ",", "1", ",", 
      RowBox[{"familyID", "+", "1"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"threadsByFamily", "[", "head_", "]"}], ":=", " ", 
   RowBox[{"GroupBy", "[", 
    RowBox[{
     RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], ",", 
     RowBox[{"#Family", "&"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"expandThread", "[", "thread_", "]"}], " ", ":=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"KeyDrop", "[", 
         RowBox[{"thread", ",", 
          RowBox[{"{", "\"\<ThreadNodes\>\"", "}"}]}], "]"}], ",", 
        RowBox[{"\"\<Node\>\"", "->", "#"}]}], "]"}], "&"}], ",", 
     RowBox[{"thread", "[", "\"\<ThreadNodes\>\"", "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"moveThreadToNextFamily", "[", 
     RowBox[{"head_", ",", "currentThreadID_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "res", ",", "currentThreadPosition", ",", "threads", ",", "thread", 
        ",", "familyID"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"threads", "=", 
        RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"currentThreadPosition", "=", 
        RowBox[{"fom", "@", 
         RowBox[{"fom", "@", 
          RowBox[{"Position", "[", 
           RowBox[{"threads", ",", 
            RowBox[{"<|", 
             RowBox[{"___", ",", 
              RowBox[{"\"\<ThreadID\>\"", "->", "currentThreadID"}], ",", 
              "___"}], "|>"}]}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"thread", "=", 
        RowBox[{
         RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], "[", 
         RowBox[{"[", "currentThreadPosition", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"familyID", "=", 
        RowBox[{"thread", "[", "\"\<Family\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"familyID", "=", 
        RowBox[{"nextFamilyID", "[", 
         RowBox[{"head", ",", "familyID"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"thread", "[", "\"\<Family\>\"", "]"}], "=", "familyID"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"threads", "[", 
         RowBox[{"[", "currentThreadPosition", "]"}], "]"}], "=", "thread"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"res", "=", "head"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"res", "[", "\"\<Threads\>\"", "]"}], "=", "threads"}], ";", 
       "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"threadEdgesThroughNodePair", "[", 
     RowBox[{
     "head_", ",", "lastNode_", ",", "nearestNode_", ",", "pruneTailNodes_"}],
      "]"}], " ", ":=", " ", 
    RowBox[{"fom", "@", 
     RowBox[{"Values", "@", 
      RowBox[{"threadsThroughNode", "[", 
       RowBox[{
        RowBox[{"head", "[", "\"\<Graph\>\"", "]"}], ",", "lastNode", ",", 
        "nearestNode", ",", "pruneTailNodes"}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"addThreadToFamily", "[", 
    RowBox[{"headArg_", ",", "currentFamily_", ",", "threadEdges_"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"head", "=", "headArg"}], ",", ",", "threadNodes", ",", 
       "familyThreads", ",", "threadID"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"threadNodes", " ", "=", " ", 
       RowBox[{"VertexList", "[", "threadEdges", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"familyThreads", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], ",", 
         RowBox[{
          RowBox[{"#Family", "==", "currentFamily"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"threadID", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "familyThreads", "]"}], "==", "0"}], ",", 
         "1", ",", 
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"#ThreadID", "&"}], "/@", "familyThreads"}], "]"}], "+", 
          "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], "=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<Family\>\"", "->", "currentFamily"}], ",", 
           RowBox[{"\"\<ThreadID\>\"", "->", "threadID"}], ",", 
           RowBox[{"\"\<ThreadNodes\>\"", "->", "threadNodes"}], ",", 
           RowBox[{"\"\<ThreadEdges\>\"", "->", "threadEdges"}]}], "|>"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "head"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, 3.945665114884842*^9, {3.94566514666432*^9, 
   3.9456651477105293`*^9}, {3.945665346443907*^9, 3.9456653759522114`*^9}, {
   3.9456654723528175`*^9, 3.9456655545482407`*^9}, {3.945665679671007*^9, 
   3.945665682407669*^9}, {3.94566573008259*^9, 3.945665779611809*^9}, {
   3.945665930114311*^9, 3.945665931734743*^9}, {3.945665969515066*^9, 
   3.9456659738494263`*^9}, {3.9456663418385754`*^9, 3.9456663543482494`*^9}, 
   3.945666389210701*^9, {3.9456664591987114`*^9, 3.945666500678274*^9}, {
   3.945666641767973*^9, 3.9456666428328533`*^9}, 3.9456668938649445`*^9, {
   3.945667010431303*^9, 3.9456670123089504`*^9}, {3.945667268305464*^9, 
   3.945667294211895*^9}, {3.945667328404913*^9, 3.9456674373115654`*^9}, {
   3.9456675249973793`*^9, 3.9456675977916813`*^9}, {3.9456728091249332`*^9, 
   3.9456728660973415`*^9}, {3.9456742686606236`*^9, 3.94567427115893*^9}, {
   3.9456743145136642`*^9, 3.945674326106121*^9}, {3.9456750723918743`*^9, 
   3.9456752158941383`*^9}, {3.945675252637268*^9, 3.945675261015665*^9}, {
   3.9456753705021477`*^9, 3.94567538850622*^9}, {3.9456755044827824`*^9, 
   3.9456755049140797`*^9}, 3.9456799893283615`*^9, {3.9456800571520786`*^9, 
   3.9456800576015015`*^9}, {3.945680174196947*^9, 3.9456801812635403`*^9}, {
   3.945680265994362*^9, 3.94568039868845*^9}, {3.945680630635401*^9, 
   3.9456807024315186`*^9}, {3.9456807558927135`*^9, 3.945680825455797*^9}, {
   3.945680859968439*^9, 3.9456809371503887`*^9}, {3.9456809794669285`*^9, 
   3.945680981149414*^9}, {3.9456810143359776`*^9, 3.9456810983985176`*^9}, {
   3.9456912331702805`*^9, 3.945691244698721*^9}, {3.9456912835314426`*^9, 
   3.945691317027191*^9}, {3.945691499321808*^9, 3.945691748730013*^9}, {
   3.945692186881399*^9, 3.9456923281194153`*^9}, {3.945693024652029*^9, 
   3.9456930304596024`*^9}, {3.945693087857849*^9, 3.945693140345827*^9}, {
   3.945693217630213*^9, 3.9456933687871647`*^9}, {3.945693415319401*^9, 
   3.945693542365555*^9}, {3.9456936039609566`*^9, 3.9456939791994343`*^9}, {
   3.9456946793013783`*^9, 3.9456946915643635`*^9}, {3.9457511674236755`*^9, 
   3.945751283460146*^9}, {3.945751494064972*^9, 3.9457515229165115`*^9}, 
   3.9457515605998344`*^9, {3.9457517733568325`*^9, 3.945751775293154*^9}, {
   3.945752374923872*^9, 3.945752400439766*^9}, {3.945752532661072*^9, 
   3.945752555394373*^9}, {3.9457525995708256`*^9, 3.9457526539994907`*^9}, {
   3.9457714349951973`*^9, 3.945771482396202*^9}, {3.945772280856207*^9, 
   3.945772345534981*^9}, {3.945772743079632*^9, 3.945772771678423*^9}, {
   3.9457728275126705`*^9, 3.945773122639967*^9}, {3.945773165093891*^9, 
   3.945773177680382*^9}, {3.945774525011381*^9, 3.945774633434973*^9}, {
   3.9458385885168476`*^9, 3.9458386058658905`*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"29457028-f3ff-8f4b-ad9e-16a62ba3dfaa"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"threadsThroughNode", "[", 
   RowBox[{
    RowBox[{"head667", "[", "\"\<Graph\>\"", "]"}], ",", "290", ",", "258", 
    ",", "1"}], "]"}], " "}]], "Input",
 CellChangeTimes->{{3.945838556521639*^9, 3.9458385825263844`*^9}, {
  3.9458386579099007`*^9, 3.945838693854412*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"cb656fac-d5a8-d848-a648-73aeeb2e72f1"],

Cell[BoxData[
 RowBox[{"\[LeftAssociation]", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"279", "\[UndirectedEdge]", "290"}], ",", 
     RowBox[{"290", "\[UndirectedEdge]", "303"}]}], "}"}], "\[Rule]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"231", "\[UndirectedEdge]", "241"}], ",", 
     RowBox[{"241", "\[UndirectedEdge]", "250"}], ",", 
     RowBox[{"250", "\[UndirectedEdge]", "258"}], ",", 
     RowBox[{"258", "\[UndirectedEdge]", "268"}], ",", 
     RowBox[{"268", "\[UndirectedEdge]", "279"}], ",", 
     RowBox[{"279", "\[UndirectedEdge]", "290"}], ",", 
     RowBox[{"290", "\[UndirectedEdge]", "303"}], ",", 
     RowBox[{"303", "\[UndirectedEdge]", "315"}], ",", 
     RowBox[{"315", "\[UndirectedEdge]", "327"}], ",", 
     RowBox[{"327", "\[UndirectedEdge]", "340"}]}], "}"}]}], 
  "\[RightAssociation]"}]], "Output",
 CellChangeTimes->{
  3.9458385838836174`*^9, {3.9458386300134144`*^9, 3.9458386947953415`*^9}},
 CellLabel->"Out[85]=",ExpressionUUID->"263b36a1-8558-3e4a-ab98-a600cd22e67c"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"threadMover", "[", "headArg_", "]"}], " ", ":=", " ", 
    RowBox[{"DynamicModule", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"currentFamily", "=", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{"currentThreadID", "=", 
         RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"mode", "=", "\"\<ThreadSelect\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"nearestNode", "=", 
         RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
        "nodeLookup", ",", "\[IndentingNewLine]", "point", ",", "familyCount",
         ",", "\[IndentingNewLine]", 
        RowBox[{"head", "=", "headArg"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"nodeLookup", "[", "head_", "]"}], ":=", " ", 
        RowBox[{"First", "/@", 
         RowBox[{"GroupBy", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Map", "[", 
             RowBox[{"expandThread", ",", 
              RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], "]"}]}], ",", 
           RowBox[{"(", 
            RowBox[{"#Node", "&"}], ")"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"familyCount", "=", "3"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Column", "@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"SetterBar", "[", 
            RowBox[{
             RowBox[{"Dynamic", "[", "mode", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"\"\<ThreadSelect\>\"", "->", "\"\<Thread select\>\""}],
               "}"}]}], "]"}], ","}], "*)"}], 
         RowBox[{
          RowBox[{
           RowBox[{"mode", "=", "\"\<ThreadSelect\>\""}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Button", "[", 
            RowBox[{"\"\<Add family\>\"", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"familyCount", "++"}], ";", 
              RowBox[{
               RowBox[{"head", "[", "\"\<FamilyCount\>\"", "]"}], "=", 
               "familyCount"}]}]}], "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Button", "[", 
           RowBox[{
           "\"\<Move thread to next family\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{"head", "=", 
             RowBox[{"moveThreadToNextFamily", "[", 
              RowBox[{"head", ",", "currentThreadID"}], "]"}]}]}], "]"}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"Button", "[", 
           RowBox[{"\"\<Save\>\"", ",", "\[IndentingNewLine]", 
            RowBox[{"saveHead", "[", "head", "]"}]}], "\[IndentingNewLine]", 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Dynamic", "@", 
           RowBox[{"SetterBar", "[", 
            RowBox[{
             RowBox[{"Dynamic", "[", "currentFamily", "]"}], ",", 
             RowBox[{"Range", "[", "familyCount", "]"}]}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Dynamic", "[", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"\"\<Current thread \>\"", ",", 
               RowBox[{"ToString", "[", 
                RowBox[{"Select", "[", 
                 RowBox[{
                  RowBox[{"head", "[", "\"\<Threads\>\"", "]"}], ",", 
                  RowBox[{
                   RowBox[{"#ThreadID", "==", "currentThreadID"}], "&"}]}], 
                 "]"}], "]"}]}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Dynamic", "[", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"\"\<Threads by family \>\"", ",", 
               RowBox[{"ToString", "[", 
                RowBox[{"Length", "/@", 
                 RowBox[{"threadsByFamily", "[", "head", "]"}]}], "]"}]}], 
              "]"}], "]"}], ","}], "\[IndentingNewLine]", "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"EventHandler", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Dynamic", "[", "\[IndentingNewLine]", 
             RowBox[{"displayHead", "[", 
              RowBox[{
              "head", ",", "currentFamily", ",", "nearestNode", ",", 
               "currentThreadID"}], "]"}], " ", "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<MouseDown\>\"", ":>", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"point", "=", " ", 
                RowBox[{"MousePosition", "[", "\"\<Graphics\>\"", "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"nearestNode", "=", 
                RowBox[{"Last", "@", 
                 RowBox[{"Last", "@", 
                  RowBox[{"NearestMeshCells", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"head", "[", "\"\<Mesh\>\"", "]"}], ",", "0"}], 
                    "}"}], ",", "point"}], "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"mode", "==", "\"\<ThreadSelect\>\""}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"currentThreadID", "=", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"nodeLookup", "[", "head", "]"}], "[", 
                    "nearestNode", "]"}], "[", "\"\<ThreadID\>\"", "]"}]}]}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"mode", "!=", "\"\<ThreadSelect\>\""}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"currentThreadID", "=", 
                    RowBox[{"Missing", "[", "]"}]}]}], "]"}], ";"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"currentThreadID", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"nodeLookup", "[", "head", "]"}], "[", 
                  "nearestNode", "]"}], "[", "\"\<ThreadID\>\"", "]"}]}], 
               ";"}], "\[IndentingNewLine]", ")"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Dynamic", "[", 
           RowBox[{"displayHeadFamilies", "[", "head", "]"}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, 3.945665114884842*^9, {3.94566514666432*^9, 
   3.9456651477105293`*^9}, {3.945665346443907*^9, 3.9456653759522114`*^9}, {
   3.9456654723528175`*^9, 3.9456655545482407`*^9}, {3.945665679671007*^9, 
   3.945665682407669*^9}, {3.94566573008259*^9, 3.945665779611809*^9}, {
   3.945665930114311*^9, 3.945665931734743*^9}, {3.945665969515066*^9, 
   3.9456659738494263`*^9}, {3.9456663418385754`*^9, 3.9456663543482494`*^9}, 
   3.945666389210701*^9, {3.9456664591987114`*^9, 3.945666500678274*^9}, {
   3.945666641767973*^9, 3.9456666428328533`*^9}, 3.9456668938649445`*^9, {
   3.945667010431303*^9, 3.9456670123089504`*^9}, {3.945667268305464*^9, 
   3.945667294211895*^9}, {3.945667328404913*^9, 3.9456674373115654`*^9}, {
   3.9456675249973793`*^9, 3.9456675977916813`*^9}, {3.9456728091249332`*^9, 
   3.9456728660973415`*^9}, {3.9456742686606236`*^9, 3.94567427115893*^9}, {
   3.9456743145136642`*^9, 3.945674326106121*^9}, {3.9456750723918743`*^9, 
   3.9456752158941383`*^9}, {3.945675252637268*^9, 3.945675261015665*^9}, {
   3.9456753705021477`*^9, 3.94567538850622*^9}, {3.9456755044827824`*^9, 
   3.9456755049140797`*^9}, 3.9456799893283615`*^9, {3.9456800571520786`*^9, 
   3.9456800576015015`*^9}, {3.945680174196947*^9, 3.9456801812635403`*^9}, {
   3.945680265994362*^9, 3.94568039868845*^9}, {3.945680630635401*^9, 
   3.9456807024315186`*^9}, {3.9456807558927135`*^9, 3.945680825455797*^9}, {
   3.945680859968439*^9, 3.9456809371503887`*^9}, {3.9456809794669285`*^9, 
   3.945680981149414*^9}, {3.9456810143359776`*^9, 3.9456810983985176`*^9}, {
   3.9456912331702805`*^9, 3.945691244698721*^9}, {3.9456912835314426`*^9, 
   3.945691317027191*^9}, {3.945691499321808*^9, 3.945691748730013*^9}, {
   3.945692186881399*^9, 3.9456923281194153`*^9}, {3.945693024652029*^9, 
   3.9456930304596024`*^9}, {3.945693087857849*^9, 3.945693140345827*^9}, {
   3.945693217630213*^9, 3.9456933687871647`*^9}, {3.945693415319401*^9, 
   3.945693542365555*^9}, {3.9456936039609566`*^9, 3.945693685551113*^9}, {
   3.945694113971056*^9, 3.9456941145341034`*^9}, {3.945694314385521*^9, 
   3.945694314993313*^9}, {3.945694526159094*^9, 3.945694651099457*^9}, {
   3.945694699731621*^9, 3.9456947666568375`*^9}, {3.945694798079582*^9, 
   3.945694821256695*^9}, {3.945694852401003*^9, 3.9456948565832424`*^9}, {
   3.9456948897714252`*^9, 3.945694955034958*^9}, {3.9456951128933563`*^9, 
   3.9456951531301956`*^9}, {3.9456951863985767`*^9, 
   3.9456952122114296`*^9}, {3.945695253683407*^9, 3.945695254177063*^9}, {
   3.945695311525028*^9, 3.94569531609688*^9}, 3.9456953841047363`*^9, {
   3.9456954250832653`*^9, 3.9456954520649033`*^9}, {3.945696118544468*^9, 
   3.9456961246302643`*^9}, 3.945751163598007*^9, {3.9457513031761208`*^9, 
   3.945751332535116*^9}, 3.945751469521675*^9, {3.945751843682356*^9, 
   3.945751862820137*^9}, {3.9457519364696445`*^9, 3.9457519448313046`*^9}, {
   3.9457523250671597`*^9, 3.945752366600672*^9}, {3.9457524372225647`*^9, 
   3.9457524963235626`*^9}, {3.945752567896824*^9, 3.9457525685196953`*^9}, 
   3.9457527350384674`*^9, {3.945752860053812*^9, 3.9457528911574*^9}, {
   3.945753184866043*^9, 3.9457532006498737`*^9}, {3.9457545210040455`*^9, 
   3.945754619880125*^9}, {3.9457565790455227`*^9, 3.945756677003681*^9}, {
   3.9457567136107845`*^9, 3.9457567152340126`*^9}, {3.945756818360668*^9, 
   3.9457569254592514`*^9}, {3.9457573020292664`*^9, 3.945757368821724*^9}, {
   3.945766036324051*^9, 3.945766060483057*^9}, {3.9457698564130745`*^9, 
   3.945769869523382*^9}, {3.9457737472457066`*^9, 3.9457737584229736`*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"a9a41704-0cbe-0b4d-97fc-88247f2eccf2"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"head667", "=", 
    RowBox[{"loadHead", "[", "667", "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"threadMover", "[", "head667", "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, 3.945665114884842*^9, {3.94566514666432*^9, 
   3.9456651477105293`*^9}, {3.945665346443907*^9, 3.9456653759522114`*^9}, {
   3.9456654723528175`*^9, 3.9456655545482407`*^9}, {3.945665679671007*^9, 
   3.945665682407669*^9}, {3.94566573008259*^9, 3.945665779611809*^9}, {
   3.945665930114311*^9, 3.945665931734743*^9}, {3.945665969515066*^9, 
   3.9456659738494263`*^9}, {3.9456663418385754`*^9, 3.9456663543482494`*^9}, 
   3.945666389210701*^9, {3.9456664591987114`*^9, 3.945666500678274*^9}, {
   3.945666641767973*^9, 3.9456666428328533`*^9}, 3.9456668938649445`*^9, {
   3.945667010431303*^9, 3.9456670123089504`*^9}, {3.945667268305464*^9, 
   3.945667294211895*^9}, {3.945667328404913*^9, 3.9456674373115654`*^9}, {
   3.9456675249973793`*^9, 3.9456675977916813`*^9}, {3.9456728091249332`*^9, 
   3.9456728660973415`*^9}, {3.9456742686606236`*^9, 3.94567427115893*^9}, {
   3.9456743145136642`*^9, 3.945674326106121*^9}, {3.9456750723918743`*^9, 
   3.9456752158941383`*^9}, {3.945675252637268*^9, 3.945675261015665*^9}, {
   3.9456753705021477`*^9, 3.94567538850622*^9}, {3.9456755044827824`*^9, 
   3.9456755049140797`*^9}, 3.9456799893283615`*^9, {3.9456800571520786`*^9, 
   3.9456800576015015`*^9}, {3.945680174196947*^9, 3.9456801812635403`*^9}, {
   3.945680265994362*^9, 3.94568039868845*^9}, {3.945680630635401*^9, 
   3.9456807024315186`*^9}, {3.9456807558927135`*^9, 3.945680825455797*^9}, {
   3.945680859968439*^9, 3.9456809371503887`*^9}, {3.9456809794669285`*^9, 
   3.945680981149414*^9}, {3.9456810143359776`*^9, 3.9456810983985176`*^9}, {
   3.9456912331702805`*^9, 3.945691244698721*^9}, {3.9456912835314426`*^9, 
   3.945691317027191*^9}, {3.945691499321808*^9, 3.945691748730013*^9}, {
   3.945692186881399*^9, 3.9456923281194153`*^9}, {3.945693024652029*^9, 
   3.9456930304596024`*^9}, {3.945693087857849*^9, 3.945693140345827*^9}, {
   3.945693217630213*^9, 3.9456933687871647`*^9}, {3.945693415319401*^9, 
   3.945693542365555*^9}, {3.9456936039609566`*^9, 3.945693685551113*^9}, {
   3.945694113971056*^9, 3.9456941145341034`*^9}, {3.945694314385521*^9, 
   3.945694314993313*^9}, {3.945694526159094*^9, 3.945694651099457*^9}, {
   3.945694699731621*^9, 3.9456947666568375`*^9}, {3.945694798079582*^9, 
   3.945694821256695*^9}, {3.945694852401003*^9, 3.9456948565832424`*^9}, {
   3.9456948897714252`*^9, 3.945694955034958*^9}, {3.9456951128933563`*^9, 
   3.9456951531301956`*^9}, {3.9456951863985767`*^9, 
   3.9456952122114296`*^9}, {3.945695253683407*^9, 3.945695254177063*^9}, {
   3.945695311525028*^9, 3.94569531609688*^9}, 3.9456953841047363`*^9, {
   3.9456954250832653`*^9, 3.9456954520649033`*^9}, {3.945696118544468*^9, 
   3.9456961246302643`*^9}, 3.945751163598007*^9, {3.9457513031761208`*^9, 
   3.945751332535116*^9}, 3.945751469521675*^9, {3.945752758198591*^9, 
   3.945752766547018*^9}, 3.9457545284705143`*^9, 3.9457873370780315`*^9},
 CellLabel->
  "In[130]:=",ExpressionUUID->"1b55b8e2-127a-b54c-916f-b5d3258281ce"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Thread creation", "Section",
 CellChangeTimes->{{3.9457658411047077`*^9, 
  3.945765844954569*^9}},ExpressionUUID->"0195eeb0-ba2e-934f-a501-\
99170430a7bc"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"threadCreator", "[", "headArg_", "]"}], " ", ":=", " ", 
    RowBox[{"DynamicModule", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"currentFamily", "=", "3"}], ",", "\[IndentingNewLine]", 
        RowBox[{"mode", "=", "\"\<NodeSelect\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"lastNode", "=", 
         RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"nearestNode", "=", 
         RowBox[{"Missing", "[", "]"}]}], ",", "\[IndentingNewLine]", 
        "nodeLookup", ",", "\[IndentingNewLine]", "point", ",", "familyCount",
         ",", "\[IndentingNewLine]", 
        RowBox[{"pruneTailNodes", "=", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"displayThreadEdges", "=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"head", "=", "headArg"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"nodeLookup", "[", "head_", "]"}], ":=", " ", 
        RowBox[{"First", "/@", 
         RowBox[{"GroupBy", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Map", "[", 
             RowBox[{"expandThread", ",", 
              RowBox[{"head", "[", "\"\<Threads\>\"", "]"}]}], "]"}]}], ",", 
           RowBox[{"(", 
            RowBox[{"#Node", "&"}], ")"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"familyCount", "=", "10"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Column", "@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<Prune tail nodes \>\"", ",", " ", 
             RowBox[{"Dynamic", "[", "pruneTailNodes", "]"}], ",", 
             RowBox[{"Slider", "[", 
              RowBox[{
               RowBox[{"Dynamic", "[", "pruneTailNodes", "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "10", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
           "]"}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Button", "[", 
              RowBox[{
               RowBox[{"StringJoin", "[", 
                RowBox[{"\"\<Save head\>\"", ",", 
                 RowBox[{"ToString", "@", 
                  RowBox[{"head", "[", "\"\<ID\>\"", "]"}]}]}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"saveHead", "[", "head", "]"}]}], 
              "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Button", "[", 
              RowBox[{"\"\<Add to family\>\"", ",", "\[IndentingNewLine]", 
               RowBox[{"head", "=", 
                RowBox[{"addThreadToFamily", "[", 
                 RowBox[{
                 "head", ",", "currentFamily", ",", "displayThreadEdges"}], 
                 " ", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "}"}], "]"}],
           ",", "\[IndentingNewLine]", 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{"\"\<Current family\>\"", ",", 
             RowBox[{"Dynamic", "@", 
              RowBox[{"SetterBar", "[", 
               RowBox[{
                RowBox[{"Dynamic", "[", "currentFamily", "]"}], ",", 
                RowBox[{"Range", "[", "familyCount", "]"}]}], "]"}]}]}], 
            "}"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"EventHandler", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Dynamic", "[", "\[IndentingNewLine]", 
             RowBox[{"displayHeadThreads", "[", 
              RowBox[{"head", ",", "\[IndentingNewLine]", 
               RowBox[{"displayThreadEdges", "=", 
                RowBox[{"threadEdgesThroughNodePair", "[", 
                 RowBox[{
                 "head", ",", "lastNode", ",", "nearestNode", ",", 
                  "pruneTailNodes"}], "]"}]}]}], "]"}], "]"}], " ", ",", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<MouseDown\>\"", ":>", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"point", "=", " ", 
                RowBox[{"MousePosition", "[", "\"\<Graphics\>\"", "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"lastNode", "=", "nearestNode"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nearestNode", "=", 
                RowBox[{"Last", "@", 
                 RowBox[{"Last", "@", 
                  RowBox[{"NearestMeshCells", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"head", "[", "\"\<Mesh\>\"", "]"}], ",", "0"}], 
                    "}"}], ",", "point"}], "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"displayThreadEdges", "=", 
                RowBox[{"threadEdgesThroughNodePair", "[", 
                 RowBox[{
                 "head", ",", "lastNode", ",", "nearestNode", ",", 
                  "pruneTailNodes"}], "]"}]}], " ", ";"}], 
              "\[IndentingNewLine]", ")"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Dynamic", "[", 
           RowBox[{"displayHeadFamilies", "[", "head", "]"}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.945662965394314*^9, 3.945663026453417*^9}, {
   3.9456630848765507`*^9, 3.945663216831663*^9}, {3.9456632501958275`*^9, 
   3.9456635632825565`*^9}, {3.9456635948594856`*^9, 3.9456638130502605`*^9}, 
   3.9456638461715775`*^9, {3.9456639629668903`*^9, 3.9456639663320007`*^9}, {
   3.9456641031556053`*^9, 3.945664138697279*^9}, {3.9456642632995663`*^9, 
   3.945664335982361*^9}, {3.9456643672206116`*^9, 3.9456644440671463`*^9}, {
   3.9456644745588665`*^9, 3.9456645742734585`*^9}, {3.945664676414156*^9, 
   3.945664705037676*^9}, {3.9456647492820454`*^9, 3.945664794237091*^9}, {
   3.9456648259621067`*^9, 3.945664910300453*^9}, {3.9456649678133755`*^9, 
   3.945664982930294*^9}, 3.945665114884842*^9, {3.94566514666432*^9, 
   3.9456651477105293`*^9}, {3.945665346443907*^9, 3.9456653759522114`*^9}, {
   3.9456654723528175`*^9, 3.9456655545482407`*^9}, {3.945665679671007*^9, 
   3.945665682407669*^9}, {3.94566573008259*^9, 3.945665779611809*^9}, {
   3.945665930114311*^9, 3.945665931734743*^9}, {3.945665969515066*^9, 
   3.9456659738494263`*^9}, {3.9456663418385754`*^9, 3.9456663543482494`*^9}, 
   3.945666389210701*^9, {3.9456664591987114`*^9, 3.945666500678274*^9}, {
   3.945666641767973*^9, 3.9456666428328533`*^9}, 3.9456668938649445`*^9, {
   3.945667010431303*^9, 3.9456670123089504`*^9}, {3.945667268305464*^9, 
   3.945667294211895*^9}, {3.945667328404913*^9, 3.9456674373115654`*^9}, {
   3.9456675249973793`*^9, 3.9456675977916813`*^9}, {3.9456728091249332`*^9, 
   3.9456728660973415`*^9}, {3.9456742686606236`*^9, 3.94567427115893*^9}, {
   3.9456743145136642`*^9, 3.945674326106121*^9}, {3.9456750723918743`*^9, 
   3.9456752158941383`*^9}, {3.945675252637268*^9, 3.945675261015665*^9}, {
   3.9456753705021477`*^9, 3.94567538850622*^9}, {3.9456755044827824`*^9, 
   3.9456755049140797`*^9}, 3.9456799893283615`*^9, {3.9456800571520786`*^9, 
   3.9456800576015015`*^9}, {3.945680174196947*^9, 3.9456801812635403`*^9}, {
   3.945680265994362*^9, 3.94568039868845*^9}, {3.945680630635401*^9, 
   3.9456807024315186`*^9}, {3.9456807558927135`*^9, 3.945680825455797*^9}, {
   3.945680859968439*^9, 3.9456809371503887`*^9}, {3.9456809794669285`*^9, 
   3.945680981149414*^9}, {3.9456810143359776`*^9, 3.9456810983985176`*^9}, {
   3.9456912331702805`*^9, 3.945691244698721*^9}, {3.9456912835314426`*^9, 
   3.945691317027191*^9}, {3.945691499321808*^9, 3.945691748730013*^9}, {
   3.945692186881399*^9, 3.9456923281194153`*^9}, {3.945693024652029*^9, 
   3.9456930304596024`*^9}, {3.945693087857849*^9, 3.945693140345827*^9}, {
   3.945693217630213*^9, 3.9456933687871647`*^9}, {3.945693415319401*^9, 
   3.945693542365555*^9}, {3.9456936039609566`*^9, 3.945693685551113*^9}, {
   3.945694113971056*^9, 3.9456941145341034`*^9}, {3.945694314385521*^9, 
   3.945694314993313*^9}, {3.945694526159094*^9, 3.945694651099457*^9}, {
   3.945694699731621*^9, 3.9456947666568375`*^9}, {3.945694798079582*^9, 
   3.945694821256695*^9}, {3.945694852401003*^9, 3.9456948565832424`*^9}, {
   3.9456948897714252`*^9, 3.945694955034958*^9}, {3.9456951128933563`*^9, 
   3.9456951531301956`*^9}, {3.9456951863985767`*^9, 
   3.9456952122114296`*^9}, {3.945695253683407*^9, 3.945695254177063*^9}, {
   3.945695311525028*^9, 3.94569531609688*^9}, 3.9456953841047363`*^9, {
   3.9456954250832653`*^9, 3.9456954520649033`*^9}, {3.945696118544468*^9, 
   3.9456961246302643`*^9}, 3.945751163598007*^9, {3.9457513031761208`*^9, 
   3.945751332535116*^9}, 3.945751469521675*^9, {3.945751843682356*^9, 
   3.945751862820137*^9}, {3.9457519364696445`*^9, 3.9457519448313046`*^9}, {
   3.9457523250671597`*^9, 3.945752366600672*^9}, {3.9457524372225647`*^9, 
   3.9457524963235626`*^9}, {3.945752567896824*^9, 3.9457525685196953`*^9}, 
   3.9457527350384674`*^9, {3.945752860053812*^9, 3.9457528911574*^9}, {
   3.945753184866043*^9, 3.9457532006498737`*^9}, {3.9457545210040455`*^9, 
   3.945754619880125*^9}, {3.9457565790455227`*^9, 3.945756677003681*^9}, {
   3.9457567136107845`*^9, 3.9457567152340126`*^9}, {3.945756818360668*^9, 
   3.9457569254592514`*^9}, {3.9457573020292664`*^9, 3.945757368821724*^9}, {
   3.945765563096115*^9, 3.945765574802389*^9}, {3.945765710965233*^9, 
   3.9457657142303104`*^9}, 3.9457660636247635`*^9, {3.945769523974106*^9, 
   3.945769564319624*^9}, 3.945769610783825*^9, {3.945769698688965*^9, 
   3.9457697388784103`*^9}, {3.945769776130272*^9, 3.945769812650341*^9}, 
   3.9457698994913063`*^9, {3.9457699303823547`*^9, 3.9457700683825474`*^9}, {
   3.9457701434120693`*^9, 3.9457702374453926`*^9}, {3.9457703002716427`*^9, 
   3.9457703462244663`*^9}, {3.945770467902958*^9, 3.945770470846689*^9}, {
   3.9457707467425365`*^9, 3.945770754608946*^9}, {3.9457713547123795`*^9, 
   3.945771426199068*^9}, {3.945772645976204*^9, 3.945772670056999*^9}, {
   3.9457732445840893`*^9, 3.9457732452220535`*^9}, {3.945773328015007*^9, 
   3.9457733349422626`*^9}, {3.945773671501526*^9, 3.9457736823773174`*^9}, {
   3.9457737769209423`*^9, 3.9457737773139153`*^9}, {3.94577422782806*^9, 
   3.945774285883667*^9}, {3.945774320371773*^9, 3.94577442833951*^9}, {
   3.945774653073801*^9, 3.9457746949507313`*^9}, {3.945787527596302*^9, 
   3.9457875307537594`*^9}, {3.9457881469227505`*^9, 
   3.9457881499363194`*^9}, {3.9457882272784157`*^9, 3.945788300633156*^9}, {
   3.9457884049729004`*^9, 3.945788419486204*^9}, 3.945788891900337*^9, {
   3.945838509021496*^9, 3.9458385169093647`*^9}, {3.945839013073145*^9, 
   3.945839039918066*^9}, {3.9458390764278545`*^9, 3.945839101627102*^9}, {
   3.945839247116665*^9, 3.9458392961419544`*^9}, {3.945839418288782*^9, 
   3.9458395087759914`*^9}, {3.945839569319805*^9, 3.9458395707694626`*^9}, {
   3.945839603619999*^9, 3.945839604826456*^9}, 3.9458396653664856`*^9, {
   3.9458396965946274`*^9, 3.9458397930509777`*^9}, 
   3.945840038581703*^9},ExpressionUUID->"c6581e53-55f5-4943-99af-\
2db53310a0c4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"head667", "=", 
   RowBox[{"loadHead", "[", "667", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"threadCreator", "[", "head667", "]"}]}], "Input",
 CellChangeTimes->{{3.9457655990635815`*^9, 3.9457656113253803`*^9}, 
   3.945765645353945*^9, {3.945839270720253*^9, 3.945839271529436*^9}},
 CellLabel->
  "In[165]:=",ExpressionUUID->"3c28c26c-9aea-cc42-886f-cf954ef5a54e"]
}, Open  ]]
},
WindowSize->{958.125, 642.75},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"14.1 for Microsoft Windows (64-bit) (July 16, 2024)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"05789d93-407c-d844-ad72-3d272192fb68"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 269, 7, 63, "Input",ExpressionUUID->"494ce339-b7c8-5341-8f74-1a3cbf665b8c",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[848, 31, 172, 6, 103, "Section",ExpressionUUID->"f449ebd4-b5df-3d46-b9f7-eb4de7708843"],
Cell[1023, 39, 1883, 26, 28, "Input",ExpressionUUID->"d02adc8b-76dd-3144-8744-7b1143e0f156"],
Cell[2909, 67, 358, 7, 28, "Input",ExpressionUUID->"d60437de-4ed1-d44f-a986-34cbce7492b4"],
Cell[3270, 76, 1249, 31, 177, "Input",ExpressionUUID->"7c241ae0-fcfd-944b-ae19-58390e21928f",
 InitializationCell->True],
Cell[4522, 109, 4991, 116, 576, "Input",ExpressionUUID->"fc060349-6b96-7242-b2b9-1c662a8b56d0",
 InitializationCell->True],
Cell[9516, 227, 1507, 37, 139, "Input",ExpressionUUID->"e5cdf50e-cefc-6544-b1c2-3c342ff44782",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[11060, 269, 170, 3, 66, "Section",ExpressionUUID->"85b3468a-0dcc-b14d-a9b4-b6eeea655c21"],
Cell[11233, 274, 367, 7, 28, "Input",ExpressionUUID->"0699b8a8-3d74-4e47-a31e-7ebe485ba841"],
Cell[11603, 283, 2504, 48, 158, "Input",ExpressionUUID->"21f95167-d15a-9540-8048-88fb0d090783",
 InitializationCell->True],
Cell[14110, 333, 1599, 26, 44, "Input",ExpressionUUID->"69a414b4-9881-494d-af3a-6e02872e95c7",
 InitializationCell->True],
Cell[15712, 361, 2185, 42, 101, "Input",ExpressionUUID->"74719bce-2dc7-bc4a-87c0-413be11034dd",
 InitializationCell->True],
Cell[17900, 405, 4308, 96, 348, "Input",ExpressionUUID->"b923d20e-8b8a-494e-af90-c6cb84dc18b3",
 InitializationCell->True],
Cell[22211, 503, 4592, 88, 424, "Input",ExpressionUUID->"12139abc-4552-7c49-8737-e3a3a50536dd",
 InitializationCell->True],
Cell[26806, 593, 332, 6, 66, "Input",ExpressionUUID->"cd3f3d1d-c737-3942-9f37-a43a7a59a6c6"],
Cell[27141, 601, 175, 2, 28, "Input",ExpressionUUID->"a13737a9-301e-434e-9ad1-d660683b078c"],
Cell[27319, 605, 327, 6, 28, "Input",ExpressionUUID->"56ad7643-db9e-284b-8fa7-806eff6f5caa"],
Cell[27649, 613, 2179, 51, 180, "Input",ExpressionUUID->"fbc371fa-c3f0-fc43-b3e8-642932d64ed2"],
Cell[29831, 666, 592, 14, 63, "Input",ExpressionUUID->"441aa0ed-bca7-6c41-ab41-482c54a4b363",
 InitializationCell->True],
Cell[30426, 682, 272, 5, 28, "Input",ExpressionUUID->"d3c49b90-8c65-7a44-b77b-807451883e73"]
}, Open  ]],
Cell[CellGroupData[{
Cell[30735, 692, 177, 3, 66, "Section",ExpressionUUID->"b0dadcd5-de9f-3d44-a928-891839f882eb"],
Cell[30915, 697, 338, 7, 47, "Input",ExpressionUUID->"45142eeb-ddcd-a44e-b2db-2f91040cf68f"],
Cell[31256, 706, 1397, 34, 199, "Input",ExpressionUUID->"8dc8c140-6b1b-8b40-998f-c1a1ef01c98c"],
Cell[32656, 742, 3177, 67, 196, "Input",ExpressionUUID->"4992593c-022c-2749-b50f-7885a4e3944c",
 InitializationCell->True],
Cell[35836, 811, 345, 5, 28, "Input",ExpressionUUID->"38a8d89f-9d05-7b4e-ab82-a3e8ff1c8912"],
Cell[36184, 818, 329, 4, 28, "Input",ExpressionUUID->"495867c4-4793-b348-aee5-9255f316209b"],
Cell[CellGroupData[{
Cell[36538, 826, 190, 3, 43, "Subsubsection",ExpressionUUID->"3e18dcb0-1ae4-854c-8baa-e7fb26beaedf"],
Cell[36731, 831, 18965, 497, 1908, "Input",ExpressionUUID->"d5c42315-0f73-684c-8a65-0ae1dabcb262",
 InitializationCell->True],
Cell[55699, 1330, 177, 3, 28, "Input",ExpressionUUID->"ea4093f8-0330-ca40-b627-280357e5be92"]
}, Open  ]],
Cell[CellGroupData[{
Cell[55913, 1338, 164, 3, 53, "Subsection",ExpressionUUID->"80c58c00-d75d-6647-8416-6dad1e12edfb"],
Cell[56080, 1343, 203, 4, 28, "Input",ExpressionUUID->"25c40d68-3108-fa4d-bfbc-264b481d02fe"],
Cell[56286, 1349, 6900, 170, 615, "Input",ExpressionUUID->"38f4ab7b-3ffd-4a40-9581-381691b955d1",
 InitializationCell->True],
Cell[63189, 1521, 19963, 495, 1737, "Input",ExpressionUUID->"b364bb2a-df7e-2146-99a2-46b06372b9de",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[83201, 2022, 162, 3, 66, "Section",ExpressionUUID->"d4512c37-5c80-bd40-99fc-a2b75f50348d"],
Cell[83366, 2027, 16695, 367, 1509, "Input",ExpressionUUID->"38863b05-16ef-e546-8710-9122f85f1958",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[100098, 2399, 158, 3, 66, "Section",ExpressionUUID->"f4644541-54e7-5948-b270-40a5fd16d526"],
Cell[100259, 2404, 9754, 208, 653, "Input",ExpressionUUID->"29457028-f3ff-8f4b-ad9e-16a62ba3dfaa",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[110038, 2616, 388, 8, 28, "Input",ExpressionUUID->"cb656fac-d5a8-d848-a648-73aeeb2e72f1"],
Cell[110429, 2626, 1023, 22, 51, "Output",ExpressionUUID->"263b36a1-8558-3e4a-ab98-a600cd22e67c"]
}, Open  ]],
Cell[111467, 2651, 10950, 202, 767, "Input",ExpressionUUID->"a9a41704-0cbe-0b4d-97fc-88247f2eccf2",
 InitializationCell->True],
Cell[122420, 2855, 3894, 55, 47, "Input",ExpressionUUID->"1b55b8e2-127a-b54c-916f-b5d3258281ce"]
}, Open  ]],
Cell[CellGroupData[{
Cell[126351, 2915, 162, 3, 66, "Section",ExpressionUUID->"0195eeb0-ba2e-934f-a501-99170430a7bc"],
Cell[126516, 2920, 11349, 197, 672, "Input",ExpressionUUID->"c6581e53-55f5-4943-99af-2db53310a0c4",
 InitializationCell->True],
Cell[137868, 3119, 411, 8, 47, "Input",ExpressionUUID->"3c28c26c-9aea-cc42-886f-cf954ef5a54e"]
}, Open  ]]
}
]
*)

